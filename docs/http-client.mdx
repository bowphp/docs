---
id: http-client
title: "ðŸš€ Http Client"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

## Introduction

Le client HTTP de BowPHP est un composant puissant et flexible permettant de rÃ©aliser des requÃªtes HTTP vers des API ou des services distants. Il utilise la bibliothÃ¨que cURL pour offrir des fonctionnalitÃ©s avancÃ©es tout en simplifiant leur utilisation.

## FonctionnalitÃ©s principales

1. MÃ©thodes HTTP supportÃ©es : `GET`, `POST`, `PUT`, `DELETE`.
2. Gestion des en-tÃªtes personnalisÃ©s.
3. Support des fichiers attachÃ©s pour les requÃªtes multipart/form-data.
4. Encodage JSON natif des donnÃ©es.
5. DÃ©finition d'une URL de base (`base_url`) pour simplifier la gestion des endpoints API.
6. Gestion des erreurs avec des exceptions spÃ©cifiques.

## Utilisation

Pour utiliser le client HTTP, crÃ©ez simplement une nouvelle instance ou injectez-le dans un service ou un contrÃ´leur :

```php
use Bow\Http\Client\HttpClient;

$client = new HttpClient();
```

:::info
Le constructeur accepte un paramÃ¨tre optionnel `$base_url`. Si l'URL de base est dÃ©finie, l'appel des endpoints devient plus simple :

```php
$client = new HttpClient('https://api.example.com');
```
:::

:::tip
Si vous n'avez pas dÃ©fini l'URL de base lors de la crÃ©ation de l'instance, utilisez `setBaseUrl` pour le faire ultÃ©rieurement :

```php
$client->setBaseUrl('https://api.example.com');
```
:::

## MÃ©thodes HTTP

### `get`

Effectue une requÃªte GET pour rÃ©cupÃ©rer des ressources.

**ParamÃ¨tres :**
- `$url` : Le chemin relatif ou l'URL complÃ¨te
- `$data` : Tableau de paramÃ¨tres ajoutÃ©s Ã  l'URL sous forme de query string

**Retourne :** Une instance de `Response`

**Exemple :**

```php
use Bow\Http\Client\HttpClient;

$client = new HttpClient('https://api.example.com');
$response = $client->get('/users', ['page' => 2, 'limit' => 10]);

echo $response->getContent();
// AccÃ©der aux donnÃ©es JSON
$users = $response->toArray();
```

### `post`

Effectue une requÃªte POST pour crÃ©er ou envoyer des donnÃ©es.

**ParamÃ¨tres :**
- `$url` : Le chemin relatif ou l'URL complÃ¨te
- `$data` : Tableau de donnÃ©es Ã  envoyer (JSON ou form-urlencoded selon la configuration)

**Retourne :** Une instance de `Response`

**Exemple :**

```php
use Bow\Http\Client\HttpClient;

$client = new HttpClient('https://api.example.com');
$response = $client->acceptJson()->post('/users', [
    'name' => 'John Doe',
    'email' => 'john.doe@example.com',
    'role' => 'admin'
]);

// VÃ©rifier le succÃ¨s
if ($response->isSuccessful()) {
    $user = $response->toArray();
    echo "Utilisateur crÃ©Ã© avec l'ID: {$user['id']}";
}
```

### `put`

Effectue une requÃªte PUT pour mettre Ã  jour une ressource existante.

**ParamÃ¨tres :**
- `$url` : Le chemin relatif ou l'URL complÃ¨te
- `$data` : Tableau de donnÃ©es Ã  envoyer pour la mise Ã  jour

**Retourne :** Une instance de `Response`

**Exemple :**

```php
use Bow\Http\Client\HttpClient;

$client = new HttpClient('https://api.example.com');
$response = $client->acceptJson()->put('/users/123', [
    'name' => 'Jane Doe',
    'email' => 'jane.doe@example.com'
]);

if ($response->isSuccessful()) {
    echo "Utilisateur mis Ã  jour avec succÃ¨s";
}
```

### `delete`

Effectue une requÃªte DELETE pour supprimer une ressource.

**ParamÃ¨tres :**
- `$url` : Le chemin relatif ou l'URL complÃ¨te
- `$data` : Tableau de donnÃ©es optionnelles Ã  envoyer

**Retourne :** Une instance de `Response`

**Exemple :**

```php
use Bow\Http\Client\HttpClient;

$client = new HttpClient('https://api.example.com');
$response = $client->delete('/users/123');

if ($response->isSuccessful()) {
    echo "Utilisateur supprimÃ© avec succÃ¨s";
}
```

## Configuration avancÃ©e

### `addAttach`

Attache un ou plusieurs fichiers Ã  une requÃªte multipart/form-data.

**ParamÃ¨tres :**
- `$attach` : Chemin du fichier (string) ou tableau de chemins de fichiers

**Retourne :** L'instance du client pour un chaÃ®nage fluide

**Exemple :**

```php
use Bow\Http\Client\HttpClient;

$client = new HttpClient('https://api.example.com');

// Upload d'un seul fichier
$response = $client->addAttach('/path/to/document.pdf')
    ->post('/upload');

// Upload de plusieurs fichiers
$response = $client->addAttach([
    '/path/to/image1.jpg',
    '/path/to/image2.jpg'
])->post('/upload-multiple');
```

### `addHeaders`

Ajoute des en-tÃªtes HTTP personnalisÃ©s Ã  la requÃªte.

**ParamÃ¨tres :**
- `$headers` : Tableau associatif d'en-tÃªtes

**Retourne :** L'instance du client pour un chaÃ®nage fluide

**Exemple :**

```php
use Bow\Http\Client\HttpClient;

$client = new HttpClient('https://api.example.com');
$response = $client
    ->addHeaders([
        'Authorization' => 'Bearer your-api-token',
        'X-Custom-Header' => 'custom-value'
    ])
    ->get('/protected-endpoint');

echo $response->getContent();
```

### `setUserAgent`

DÃ©finit l'agent utilisateur (User-Agent) pour la requÃªte.

**ParamÃ¨tres :**
- `$user_agent` : ChaÃ®ne reprÃ©sentant l'agent utilisateur

**Retourne :** L'instance du client pour un chaÃ®nage fluide

**Exemple :**

```php
use Bow\Http\Client\HttpClient;

$client = new HttpClient('https://api.example.com');
$response = $client
    ->setUserAgent('MyApp/1.0 (Bow Framework)')
    ->get('/users');

echo $response->getContent();
```

### `acceptJson`

Configure le client pour envoyer et accepter des donnÃ©es au format JSON.
Ajoute automatiquement l'en-tÃªte `Content-Type: application/json`.

**Retourne :** L'instance du client pour un chaÃ®nage fluide

**Exemple :**

```php
use Bow\Http\Client\HttpClient;

$client = new HttpClient('https://api.example.com');
$response = $client
    ->acceptJson()
    ->post('/users', [
        'name' => 'John Doe',
        'email' => 'john@example.com'
    ]);

// Les donnÃ©es seront automatiquement encodÃ©es en JSON
$result = $response->toArray();
```

## La classe `Response`

La classe `Response` encapsule toutes les informations retournÃ©es par une requÃªte HTTP : contenu, en-tÃªtes, code de statut et mÃ©triques de performance. Elle offre une interface simple et intuitive pour manipuler les rÃ©ponses.

### MÃ©thodes principales

#### `getContent`

```php
public function getContent(): ?string
```

Retourne le contenu brut de la rÃ©ponse HTTP sous forme de chaÃ®ne. Retourne `null` si aucun contenu n'est disponible.

**Exemple :**

```php
$content = $response->getContent();
echo $content;
```

#### `toJson`

```php
public function toJson(?bool $associative = null): object|array
```

DÃ©code le contenu JSON de la rÃ©ponse en objet ou tableau PHP.

**ParamÃ¨tres :**
- `$associative` : `true` pour un tableau associatif, `false` pour un objet (dÃ©faut)

**Exemple :**

```php
// Retourne un objet
$user = $response->toJson();
echo $user->name;

// Retourne un tableau
$userData = $response->toJson(true);
echo $userData['name'];
```

#### `toArray`

```php
public function toArray(): array
```

Alias de `toJson(true)`. Retourne le contenu JSON sous forme de tableau associatif.

**Exemple :**

```php
$users = $response->toArray();
foreach ($users as $user) {
    echo $user['name'];
}
```

#### `getHeaders`

```php
public function getHeaders(): array
```

Retourne les en-tÃªtes HTTP de la rÃ©ponse sous forme de tableau. Ce tableau contient des informations telles que le code de statut HTTP, le type de contenu, le temps d'exÃ©cution, etc.

#### `getCode` / `statusCode`

```php
public function getCode(): ?int
public function statusCode(): ?int
```

Retournent le code de statut HTTP de la rÃ©ponse (200, 404, 500, etc.). Retourne `null` si indisponible.

**Exemple :**

```php
$code = $response->getCode();
// ou
$code = $response->statusCode();

if ($code === 200) {
    echo "RequÃªte rÃ©ussie";
}
```

#### `isSuccessful`

```php
public function isSuccessful(): bool
```

Retourne `true` si le code de statut indique un succÃ¨s (200 ou 201).

**Exemple :**

```php
if ($response->isSuccessful()) {
    $data = $response->toArray();
    // Traiter les donnÃ©es
}
```

#### `isFailed`

```php
public function isFailed(): bool
```

Retourne `true` si la requÃªte a Ã©chouÃ© (code diffÃ©rent de 200 ou 201).

**Exemple :**

```php
if ($response->isFailed()) {
    echo "Erreur : " . $response->getCode();
}
```

### MÃ©triques de performance

Le client HTTP fournit plusieurs mÃ©thodes pour analyser les performances des requÃªtes :

| MÃ©thode | Description | Retour |
|---------|-------------|--------|
| `getExecutionTime()` | Temps total d'exÃ©cution de la requÃªte | `?int` (secondes) |
| `getConnexionTime()` | Temps d'Ã©tablissement de la connexion | `?float` (secondes) |
| `getUploadSize()` | Taille des donnÃ©es envoyÃ©es | `?int` (octets) |
| `getUploadSpeed()` | Vitesse d'upload | `?float` (octets/sec) |
| `getDownloadSize()` | Taille des donnÃ©es reÃ§ues | `?int` (octets) |
| `getDownloadSpeed()` | Vitesse de download | `?float` (octets/sec) |

**Exemple d'utilisation :**

```php
$response = $client->get('/large-data');

echo "Temps d'exÃ©cution : " . $response->getExecutionTime() . "s\n";
echo "Taille tÃ©lÃ©chargÃ©e : " . $response->getDownloadSize() . " octets\n";
echo "Vitesse : " . $response->getDownloadSpeed() . " octets/s\n";
```

### Gestion des erreurs

**`getErrorMessage`** : Retourne le message d'erreur cURL s'il y en a un, sinon une chaÃ®ne vide.

**`getErrorNumber`** : Retourne le code d'erreur cURL.

**Exemple :**

```php
if ($response->isFailed()) {
    echo "Erreur #{$response->getErrorNumber()}: {$response->getErrorMessage()}";
}
```

### Autres mÃ©thodes

#### `getHeaders`

```php
public function getHeaders(): array
```

Retourne tous les en-tÃªtes HTTP de la rÃ©ponse sous forme de tableau.

#### `getContentType`

```php
public function getContentType(): ?string
```

Retourne le type MIME du contenu (ex: `application/json`, `text/html`).

**Exemple :**

```php
$contentType = $response->getContentType();
if ($contentType === 'application/json') {
    $data = $response->toArray();
}
```

<SuggestionFeature />
