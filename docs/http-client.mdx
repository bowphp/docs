---
id: http-client
title: "üöÄ Http Client"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

Le client HTTP de BowPHP est un composant puissant et flexible permettant de r√©aliser des requ√™tes HTTP vers des API ou des services distants. Il utilise la biblioth√®que cURL pour offrir des fonctionnalit√©s avanc√©es tout en simplifiant leur utilisation.

## Fonctionnalit√©s principales

1. M√©thodes HTTP support√©es : `GET`, `POST`, `PUT`, `DELETE`.
2. Gestion des en-t√™tes personnalis√©s.
3. Support des fichiers attach√©s pour les requ√™tes multipart/form-data.
4. Encodage JSON natif des donn√©es.
5. D√©finition d'une URL de base (`base_url`) pour simplifier la gestion des endpoints API.
6. Gestion des erreurs avec des exceptions sp√©cifiques.

## Utilisation

Pour utilisateur le client http rien de plus simple que de faire une nouvelle instance ou une injection dans un service ou un contr√¥leur :

```php
$client = new HttpClient();
```

:::info
Le constructeur prend un param√®tre $base_url qui est optionnel. Si le base url est define l'appel des endpoints devient plus simple

```php
$client = new HttpClient('https://api.example.com');
```
:::

> Dans le cas ou nous n'avez pas d√©finit la base url √† la cr√©ation de l'instance, `setBaseUrl` nous permet de le faire.

#### `get`

Effectue une requ√™te GET.

- **Param√®tres** :
  - `$url` : Le chemin relatif ou l'URL compl√®te.
  - `$data` : Les param√®tres de la requ√™te (ajout√©s √† l'URL sous forme de cha√Æne de requ√™te).
- **Retourne** :
  - Une instance de `Response` contenant les donn√©es de la r√©ponse.

```php
$client = new HttpClient('https://api.example.com');
$response = $client->get('/users', ['page' => 2]);

echo $response->getContent();
```

#### `post`

Effectue une requ√™te POST.

- **Param√®tres** :
  - `$url` : Le chemin relatif ou l'URL compl√®te.
  - `$data` : Les donn√©es √† envoyer (JSON ou `application/x-www-form-urlencoded`).
- **Retourne** :
  - Une instance de `Response` contenant les donn√©es de la r√©ponse.

```php
$client = new HttpClient('https://api.example.com');
$response = $client->acceptJson()->post('/users', [
    'name' => 'John Doe',
    'email' => 'john.doe@example.com'
]);

echo $response->getContent();
```

#### `put`

Effectue une requ√™te PUT.

- **Param√®tres** :
  - `$url` : Le chemin relatif ou l'URL compl√®te.
  - `$data` : Les donn√©es √† envoyer.
- **Retourne** :
  - Une instance de `Response` contenant les donn√©es de la r√©ponse.

```php
$client = new HttpClient('https://api.example.com');
$response = $client->acceptJson()->put('/users', [
    'name' => 'John Doe',
    'email' => 'john.doe@example.com'
]);

echo $response->getContent();
```

#### `delete`

Effectue une requ√™te DELETE.

- **Param√®tres** :
  - `$url` : Le chemin relatif ou l'URL compl√®te.
  - `$data` : Les donn√©es √† envoyer (si applicables).
- **Retourne** :
  - Une instance de `Response` contenant les donn√©es de la r√©ponse.

```php
$client = new HttpClient('https://api.example.com');
$response = $client->delete('/users/2');

echo $response->getContent();
```

#### `addAttach`

Attache un ou plusieurs fichiers √† la requ√™te.

- **Param√®tres** :
  - `$attach` : Chemin(s) du ou des fichiers √† envoyer.
- **Retourne** :
  - L'instance du client pour un cha√Ænage fluide.

```php
$client = new HttpClient('https://api.example.com');
$response = $client->addAttach('/path/to/file.txt')->post('/upload');

echo $response->getContent();
```

### addHeaders

Ajoute des en-t√™tes personnalis√©s √† la requ√™te.

- **Param√®tres** :
  - `$headers` : Tableau associatif des en-t√™tes (ex. : `['Authorization' => 'Bearer token']`).
- **Retourne** :
  - L'instance du client pour un cha√Ænage fluide.

```php
$client = new HttpClient('https://api.example.com');
$response = $client->get('/users', ['page' => 2]);

echo $response->getContent();
```

### setUserAgent

D√©finit l'agent utilisateur pour la requ√™te.

- **Param√®tres** :
  - `$user_agent` : Cha√Æne repr√©sentant l'agent utilisateur.
- **Retourne** :
  - L'instance du client pour un cha√Ænage fluide.

```php
$client = new HttpClient('https://api.example.com');
$response = $client->get('/users', ['page' => 2]);

echo $response->getContent();
```

### acceptJson

Configure le client pour envoyer et accepter des donn√©es au format JSON.

- **Retourne** :
  - L'instance du client pour un cha√Ænage fluide.

```php
$client = new HttpClient('https://api.example.com');
$response = $client->get('/users', ['page' => 2]);

echo $response->getContent();
```

## La classe `Response`

La classe `Response` est utilis√©e pour manipuler la r√©ponse. Elle encapsule les informations retourn√©es par la requ√™te, telles que le contenu de la r√©ponse, les en-t√™tes HTTP, le code de statut, ainsi que des informations de performance. Voici une vue d'ensemble des fonctionnalit√©s de cette classe.

### M√©thodes

#### `getContent`

```php
public function getContent(): ?string
```

Cette m√©thode retourne le contenu de la r√©ponse HTTP sous forme de cha√Æne de caract√®res. Si aucun contenu n'est disponible, elle retourne `null`.

#### `toJson`

```php
public function toJson(?bool $associative = null): object|array
```

Cette m√©thode permet de d√©coder le contenu de la r√©ponse (en supposant qu'il soit au format JSON) en un objet ou un tableau PHP. Le param√®tre optionnel `$associative` permet de choisir si le r√©sultat doit √™tre un tableau associatif (`true`) ou un objet (`false`).

#### `toArray`

```php
public function toArray(): array
```

C'est une m√©thode alias de `toJson(true)`, qui retourne le contenu JSON de la r√©ponse sous forme de tableau associatif.

#### `getHeaders`

```php
public function getHeaders(): array
```

Retourne les en-t√™tes HTTP de la r√©ponse sous forme de tableau. Ce tableau contient des informations telles que le code de statut HTTP, le type de contenu, le temps d'ex√©cution, etc.

#### `getCode` / `statusCode`

```php
public function getCode(): ?int
public function statusCode(): ?int
```

Ces m√©thodes retournent le code de statut HTTP de la r√©ponse (par exemple, 200 pour une requ√™te r√©ussie, 404 pour une ressource introuvable). Si le code de statut n'est pas disponible, elles retournent `null`.

#### `isSuccessful`

```php
public function isSuccessful(): bool
```

Cette m√©thode retourne `true` si le code de statut HTTP indique une r√©ponse r√©ussie (200 ou 201), sinon elle retourne `false`.

#### `isFailed`

```php
public function isFailed(): bool
```

Cette m√©thode retourne `true` si le code de statut HTTP indique une erreur (tout code autre que 200 ou 201), sinon elle retourne `false`.

#### Informations de performance

Le client HTTP de Bow fournit √©galement des m√©thodes pour obtenir des informations sur la performance de la requ√™te HTTP.

- **`getExecutionTime`** : Retourne le temps total d'ex√©cution de la requ√™te en secondes.
- **`getConnexionTime`** : Retourne le temps n√©cessaire pour √©tablir une connexion avec le serveur.
- **`getUploadSize`** : Retourne la taille des donn√©es envoy√©es lors de la requ√™te en octets.
- **`getUploadSpeed`** : Retourne la vitesse de t√©l√©chargement des donn√©es envoy√©es.
- **`getDownloadSize`** : Retourne la taille des donn√©es re√ßues lors de la requ√™te en octets.
- **`getDownloadSpeed`** : Retourne la vitesse de t√©l√©chargement des donn√©es re√ßues.

Ces informations sont utiles pour analyser les performances des requ√™tes HTTP, en particulier dans des sc√©narios o√π la rapidit√© et l'efficacit√© sont essentielles.

#### Gestion des erreurs

- **`getErrorMessage`** : Retourne le message d'erreur, s'il y en a un. Si aucune erreur n'est pr√©sente, cette m√©thode retourne une cha√Æne vide.
- **`getErrorNumber`** : Retourne le code d'erreur cURL, s'il y en a un.

#### `getContentType`

```php
public function getContentType(): ?string
```

Cette m√©thode retourne le type de contenu retourn√© par la r√©ponse (par exemple, `application/json`), ou `null` si ce type n'est pas disponible.

<SuggestionFeature />
