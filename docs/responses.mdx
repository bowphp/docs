---
id: http-response
title: "ðŸ“¦ Response"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

## Introduction

:::info Ã€ propos des rÃ©ponses HTTP
Toutes les routes et contrÃ´leurs doivent retourner une rÃ©ponse Ã  renvoyer Ã  l'utilisateur. Bow fournit plusieurs faÃ§ons diffÃ©rentes de renvoyer des rÃ©ponses.
:::

La rÃ©ponse la plus Ã©lÃ©mentaire est le retour d'une chaÃ®ne depuis une route ou un contrÃ´leur. Bow convertira automatiquement la chaÃ®ne en une rÃ©ponse HTTP complÃ¨te.

## Envoyer une rÃ©ponse

### Une chaÃ®ne de caractÃ¨res

Une rÃ©ponse HTTP peut Ãªtre une chaÃ®ne de caractÃ¨res.

```php
$app->get('/', function () {
  return "Hello, world";
});
```

### Une collection, un tableau ou un objet

Une rÃ©ponse HTTP peut Ãªtre une instance de [`Bow\Support\Collection`](https://bowphp.com/api/master/Bow/Support/Collection.html).

```php
$app->get('/array', function () {
  return [10, 2, 12, 'name' => 'Dakia'];
});

$app->get('/collection', function () {
  return collect([10, 2, 12]);
});

$app->get('/object', function () {
  return (object) ['name' => 'Dakia'];
});
```

### Un modÃ¨le BARRY

La rÃ©ponse HTTP peut Ãªtre un `Model` ou une `Collection` de modÃ¨les. Bow les convertit directement en `JSON`.

```php
use App\Models\User;

$app->get('/', function () {
  $model = User::where('id', 1)->first();
  
  return $model;
});
```

## Modification de la rÃ©ponse

### Modification du code de statut

:::tip Code de statut HTTP
Il est trÃ¨s important d'ajouter les codes de statut appropriÃ©s Ã  votre rÃ©ponse HTTP si vous dÃ©veloppez une API REST. La mÃ©thode `status` vous permet de le faire.
:::

```php
use App\Models\User;

$app->get('/', function () {
  $response = response();
  
  return $response->status(400);
});
```

Pour plus d'information sur les codes HTTP, consultez ce [lien](https://fr.wikipedia.org/wiki/Liste_des_codes_HTTP).

:::tip Astuce 204 vs 200
Si dans votre API, la requÃªte a Ã©tÃ© traitÃ©e avec succÃ¨s et que vous n'avez pas d'information Ã  renvoyer, il est prÃ©fÃ©rable de retourner un **204** plutÃ´t qu'un **200**.
:::

### Ajouter un en-tÃªte HTTP

Souvent, vous serez amenÃ© Ã  ajouter d'autres en-tÃªtes HTTP Ã  votre rÃ©ponse HTTP. Les mÃ©thodes `addHeader` et `withHeaders` vous permettent de le faire.

```php
$response->addHeader('Content-Type', 'application/json');
```

Vous pouvez ajouter plusieurs en-tÃªtes en mÃªme temps :

```php
$response->withHeaders([
  'Content-Type' => 'application/json',
  'X-Proto-Value' => 1
]);
```

## Envoyer un JSON

Dans les applications REST (API REST/RESTful), les informations sont gÃ©nÃ©ralement retournÃ©es en JSON. Pour envoyer une information JSON au client, vous pouvez utiliser le helper `json` ou la mÃ©thode `json` sur l'instance de `Bow\Http\Response`.

### Prototype de la mÃ©thode `json`

```php
$response->json($data, $code, $headers);
```

| ParamÃ¨tre | Type | Description |
|----------|------|------|
| $data  | **Array**, `stdClass`, `Iterable`, `JsonSerializable` | Les donnÃ©es Ã  sÃ©rialiser |
| $code  | **Int** | Le code du statut HTTP |
| $headers  | **Array** | Les en-tÃªtes Ã  ajouter Ã  la rÃ©ponse |

### Exemple d'envoi de JSON

Exemple :

```php
$data = ['message' => 'Hello, World'];

return $response->json($data, $code = 200, [
  'X-Proto-Value' => 1 // Juste un test
]);
```

Avec le HELPER `response_json` :

```php
$data = ['message' => 'Hello, World'];

return response_json($data, 200, [
  'X-Proto-Value' => 1 // Juste un test
]);
```

:::info Automatisation de l'en-tÃªte
Bow ajoute directement l'en-tÃªte HTTP `Content-Type` Ã  `application/json`, donc plus besoin de l'ajouter manuellement dans le `$headers`.
:::

## Envoyer une rÃ©ponse depuis les vues

Souvent, vous pouvez utiliser une instance de `Bow\Http\Response` pour faire le rendu de [vue](./views) via la mÃ©thode `render`.

### Prototype de la mÃ©thode `render`

```php
$response->render($name, $data, $code, $headers);
```

| ParamÃ¨tre | Type | Description |
|----------|------|
| $name | **String** | Le nom d'une vue Ã  rendre |
| $data | **Array** | Les donnÃ©es Ã  envoyer Ã  la vue |
| $code | **Int** | Le code du statut HTTP |
| $headers | **Array** | Les en-tÃªtes Ã  ajouter Ã  la rÃ©ponse |

### Exemple d'envoi de vue

Exemple :

```php
$users = User::where('id', '!=', 2)->get();

return $response->render('users', ['users' => $users], 200, [
  'X-Proto-Value' => 1 // Juste un test
]);
```

### TÃ©lÃ©charger un fichier

Souvent, vous serez amenÃ© Ã  mettre en place des systÃ¨mes de tÃ©lÃ©chargement de fichiers zip ou images. Vous allez aussi faire des applications avec lesquelles il faut s'authentifier avant de tÃ©lÃ©charger des fichiers (type Dropbox). Bow offre une API simple via la classe [`Bow\Http\Response`](https://bowphp.com/api/master/Bow/Http/Response.html) pour tÃ©lÃ©charger un fichier avec la mÃ©thode `download`.

### Prototype de la mÃ©thode `download`

```php
$response->download($file, $filename = null, $headers, $disposition = 'attachment');
```

| ParamÃ¨tre | Type | Description |
|----------|------|------|
| $file  | **String** | Le chemin absolu du fichier |
| $filename  | **String** | Le nom du fichier (par dÃ©faut **null**) |
| $headers  | **Array** | Les en-tÃªtes Ã  ajouter Ã  la rÃ©ponse |
| $disposition  | **String** | Indiquant si le contenu devrait Ãªtre affichÃ© en ligne dans le navigateur (page Web) ou en piÃ¨ce jointe tÃ©lÃ©chargÃ©e et enregistrÃ©e localement |

Plus d'informations sur l'en-tÃªte [`Content-Disposition`](https://developer.mozilla.org/fr/docs/Web/HTTP/Headers/Content-Disposition).

### Exemple de tÃ©lÃ©chargement

Exemple :

```php
$file = '/path/to/file.png';

return $response->download($file, 'image.png');
```

Et vous pouvez utiliser le helper `response_download`.

## Redirection

Vous serez certainement amenÃ© Ã  faire des redirections vers d'autres ressources, et cela constitue en rÃ©alitÃ© une rÃ©ponse HTTP. Les mÃ©thodes `to` et `back` (qui, comme son nom l'indique, permet de revenir en arriÃ¨re) de la classe [`Bow\Http\Redirect`](https://bowphp.com/api/master/Bow/Http/Redirect.html).

### Redirection avec `to`

La redirection avec `to` permet de renvoyer l'utilisateur sur une autre la page.

```php
return redirect()->to($path);
```

#### Prototype de `to`

| ParamÃ¨tre | Type | Description |
|----------|------|------|
| $path  | **String** | L'URL de rÃ©direction |

```php
return redirect()->to('/users');
```

### Redirection avec `back`

La redirection avec `back` permet de renvoyer l'utilisateur sur la page prÃ©cÃ©dente.

```php
return redirect()->back($status_code);
```

#### Prototype de `back`

| ParamÃ¨tre | Type | Description |
|----------|------|------|
| $status_code  | **Int** | Le code HTTP de la rÃ©ponse (par dÃ©faut Ã©gal Ã  `302`) |

```php
return redirect()->back();
```

### Redirection avec des informations

Vous pouvez aussi faire la redirection avec les informations envoyÃ©es par l'utilisateur avec les mÃ©thodes `withInput` et `withFlash` comme ceci :

```php
 return redirect()->back()->withInput();
 // Ou
 return redirect()->to("/home")->withInput();
```

Avec un message flash

```php
 return redirect()->back()->withFlash('success', 'Papac');
```

Notez que vous pouvez donner un tableau de valeur Ã  `withInput` qui sera une collection d'information Ã  envoyer Ã  utilisateur.

<SuggestionFeature />
