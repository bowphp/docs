---
id: http-response
title: "ðŸ“¦ Response"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

## Introduction

Tous les routes et contrÃ´leurs doivent retourner une rÃ©ponse Ã  renvoyer Ã  l'utilisateur. Bow fournit plusieurs faÃ§ons diffÃ©rentes de renvoyer des rÃ©ponses. La rÃ©ponse la plus Ã©lÃ©mentaire est le retour d'une chaÃ®ne depuis une route ou un contrÃ´leur. Bow convertira automatiquement la chaÃ®ne en une rÃ©ponse HTTP complÃ¨te.

## EnvoyÃ© une rÃ©ponse

### Une chaine de caractÃ¨re

Une rÃ©ponse HTTP peut Ãªtre une chaine de caractÃ¨re.

```php
$app->get('/', function () {
  return "Hello, world";
});
```

### Une Collection et Un tableau ou un Object

Une rÃ©ponse HTTP peut Ãªtre une instance de [`Bow\Support\Collection`](https://bowphp.com/api/master/Bow/Support/Collection.html).

```php
$app->get('/array', function () {
  return [10, 2, 12, 'name' => 'Dakia'];
});

$app->get('/collection', function () {
  return collect([10, 2, 12]);
});

$app->get('/object', function () {
  return (object) ['name' => 'Dakia'];
});
```

### Un modÃ¨le BARRY

La rÃ©ponse HTTP peut Ãªtre un `Model` ou une `Collection` de modÃ¨le, Bow la convertis directement en `JSON`.

```php
use App\Models\User;

$app->get('/', function () {
  $model = User::where('id', 1)->first();
  
  return $model;
});
```

## Modification de rÃ©ponse

### Modification du code d'erreur

Il est trÃ¨s important d'ajouter les codes d'erreurs Ã  votre rÃ©ponse HTTP si vous dÃ©veloppez un API RESTFUL. La mÃ©thode `status` vous permet de le faire.

```php
use App\Models\User;

$app->get('/', function () {
  $response = response();
  
  return $response->status(400);
});
```

Pour plus d'information sur les code HTTP. Consultez ce [lien](https://fr.wikipedia.org/wiki/Liste_des_codes_HTTP).

Si dans votre API, la requÃªte a Ã©tÃ© traitÃ©e avec succÃ¨s et que vous n'avez pas dâ€™information Ã  renvoyer. Il est prÃ©fÃ©rable de lui retourne un **204** qu'un **200** :tada:.

### Ajouter une entÃªte HTTP

Souvent vous serez amener Ã  ajouter d'autre entÃªte HTTP Ã  votre rÃ©ponse HTTP. La mÃ©thode `addHeader` et `withHeaders` vous permet de le faire.

```php
$response->addHeader('Content-Type', 'application/json');
```

Nous pouvez ajouter plusieur entÃªte en mÃªme temps:

```php
$response->withHeaders([
  'Content-Type' => 'application/json',
  'X-Proto-Value' => 1
]);
```

## Envoyer un JSON

Dans les applications REST (Api REST/RESTFUL) les informations sont gÃ©nÃ©ralement retournÃ©s en JSON. Pour envoyer un information JSON au client, vous pouvez utiliser le help `json` ou la mÃ©thode `json` sur l'instance de `Bow\Http\Response`.

### Prototype de la mÃ©thode `json`

```php
$response->json($data, $code, $headers);
```

| ParamÃ¨tre | Type | Description |
|----------|------|------|
| $data  | **Array**, `stdClass`, `Iterable`, `JsonSerializable` | Les donnÃ©es Ã  sÃ©rialiser |
| $code  | **Int** | Le code du status HTTP |
| $headers  | **Array** | Les entÃªtes Ã  ajouter sur le rÃ©ponse |

### Exemple d'envoyÃ© de JSON

Exemple :

```php
$data = ['message' => 'Hello, World'];

return $response->json($data, $code = 200, [
  'X-Proto-Value' => 1 // Juste un test
]);
```

Avec le HELPER :

```php
$data = ['message' => 'Hello, World'];

return json($data, 200, [
  'X-Proto-Value' => 1 // Juste un test
]);
```

Ici, Bow ajout directement l'entÃªte HTTP `Content-Type` Ã  `application/json`, donc plus besoin de l'ajouter manuellement dans le `$headers`.

## Envoyer une rÃ©ponse depuis les vues

Souvent, vous pouvez utiliser une instance de `Bow\Http\Response` pour faire le rendu de [vue](./views) via la mÃ©thode `render`.

### Prototype de la mÃ©thode `render`

```php
$response->render($name, $data, $code, $headers);
```

| ParamÃ¨tre | Type | Description |
|----------|------|
| $name | **String** - Le nom d'une vue Ã  rendre |
| $data | **Array** - Les donnÃ©es Ã  envoyer Ã  la vue |
| $code | **Int** - Le code du status HTTP |
| $headers | **Array** - Les entÃªtes Ã  ajouter Ã  la rÃ©ponse |

### Exemple d'envoye de vue

Exemple :

```php
$users = User::where('id', '!=', 2)->get();

return $response->render('users', ['users' => $users], 200, [
  'X-Proto-Value' => 1 // Juste un test
]);
```

### TÃ©lÃ©charger un fichier

Souvent, vous serez amener Ã  mettre en place des systÃ¨mes de tÃ©lÃ©chargement de fichier zip ou image, encore, vous allez faire des applications avec lesquelles il faut s'authentifier avant de tÃ©lÃ©charger des fichiers du type dropbox. Bow offre un API simple via la classe [`Bow\Http\Response`](https://bowphp.com/api/master/Bow/Http/Response.html) pour tÃ©lÃ©charger un fichier avec la mÃ©thode `download`.

### Prototype de la mÃ©thode `download`

```php
$response->download($file, $filename = null, $headers, $disposition = 'attachment');
```

| ParamÃ¨tre | Type | Description |
|----------|------|------|
| $file  | **String** | Le chemin absolu du fichier |
| $filename  | **String** | Le nouveau du fichier par defaut est **null** |
| $headers  | **Array** | Les entÃªtes Ã  ajouter Ã  la rÃ©ponse |
| $disposition  | **String** | Indiquant si le contenu devrait Ãªtre affichÃ© en ligne dans le navigateur, c'est-Ã -dire en tant que page Web, ou en piÃ¨ce jointe tÃ©lÃ©chargÃ© et enregistrÃ© localement. |

Plus d'information sur l'entÃªte [`Content-Disposition`](https://developer.mozilla.org/fr/docs/Web/HTTP/Headers/Content-Disposition).

### Exemple de tÃ©lÃ©charger

Exemple :

```php
$file = '/path/to/file.png';

return $response->download($file, 'image.png');
```

## Redirection

Vous serez certainement amenÃ© Ã  faire des redirections vers d'autres ressources, et cela, en rÃ©alitÃ© constitue une rÃ©ponse HTTP. Les mÃ©thodes `to` et `back` (qui comme son nom l'indique permet de faire une revenir sÃ»r en arriÃ¨re) de la classe [`Bow\Http\Redirect`](https://bowphp.com/api/master/Bow/Http/Redirect.html).

### Redirection avec `to`

La redirection avec `to` permet de renvoyer l'utilisateur sur une autre la page.

```php
return redirect()->to($path);
```

#### Prototype de `to`

| ParamÃ¨tre | Type | Description |
|----------|------|------|
| $path  | **String** | L'URL de rÃ©direction |

```php
return redirect()->to('/users');
```

### Redirection avec `back`

La redirection avec `back` permet de renvoyer l'utilisateur sur la page prÃ©cÃ©dente.

```php
return redirect()->back($status_code);
```

#### Prototype de `back`

| ParamÃ¨tre | Type |
|----------|------|
| $status_code  | **Int** - Le code HTTP de la rÃ©ponse par defaut est Ã©gale Ã  `302` |

```php
return redirect()->back();
```

### Redirection avec des informations

Vous pouvez aussi faire la redirection avec les informations envoyÃ©e par l'utilisateur et ceci avec la mÃ©thode `withInput`, `withFlash` comme ceci :

```php
 return redirect()->back()->withInput();
 // Ou
 return redirect()->to("/home")->withInput();
```

Avec un message flash

```php
 return redirect()->back()->withFlash('success', 'Papac');
```

Notez que vous pouvez donner un tableau de valeur Ã  `withInput` qui sera une collection d'information Ã  envoyer Ã  utilisateur.

<SuggestionFeature />
