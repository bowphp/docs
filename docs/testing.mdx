---
id: testing
title: "ðŸ›« Testez votre application"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

### Introduction

L'API de test fonctionnel de BowPHP permet de tester vos API de maniÃ¨re fluide en utilisant des requÃªtes HTTP. Cette API est construite autour de PHPUnit, ce qui vous permet d'utiliser toute la puissance de ce framework pour effectuer des tests. Les principales opÃ©rations HTTP (GET, POST, PUT, DELETE, PATCH) sont couvertes, et il est possible d'ajouter des en-tÃªtes ou des piÃ¨ces jointes Ã  vos requÃªtes.

### Classe `TestCase`

La classe principale pour utiliser l'API de test est `TestCase`, qui Ã©tend la classe `PHPUnitTestCase` de PHPUnit. Elle fournit une interface simple pour envoyer des requÃªtes HTTP et vÃ©rifier les rÃ©ponses.

### **MÃ©thodes de la classe `TestCase`**

Le base_url des appÃ¨ls HTTP est la valeur `APP_URL`, mais vous pouvez aussi la spÃ©cifier manuellement avec la propriÃ©tÃ© url dans la classe du test unitaire.

#### **2. `attach(array $attach)`**
Permet d'ajouter des piÃ¨ces jointes (fichiers ou donnÃ©es) Ã  vos requÃªtes.

**Exemple d'utilisation** :

```php
$test->attach([
    'file' => new \CURLFile('/path/to/file.jpg')
]);
```

#### **3. `withHeaders(array $headers)`**
Permet de spÃ©cifier des en-tÃªtes supplÃ©mentaires pour toutes les requÃªtes suivantes.

```php
$test->withHeaders([
    'Authorization' => 'Bearer token',
    'Content-Type' => 'application/json'
]);
```

#### **4. `withHeader(string $key, string $value)`**
Ajoute un en-tÃªte unique Ã  vos requÃªtes.

```php
$test->withHeader('X-Custom-Header', 'custom_value');
```

#### **5. `get(string $url, array $param = [])`**
Effectue une requÃªte GET. Vous pouvez ajouter des paramÃ¨tres supplÃ©mentaires Ã  la requÃªte.

```php
$response = $test->get('/api/users', ['page' => 1]);
```

#### **6. `post(string $url, array $param = [])`**
Effectue une requÃªte POST. Vous pouvez ajouter des donnÃ©es et des fichiers en utilisant la mÃ©thode `attach()`.

```php
$response = $test->post('/api/users', ['name' => 'John Doe']);
```

#### **7. `put(string $url, array $param = [])`**
Effectue une requÃªte PUT.

```php
$response = $test->put('/api/users/1', ['name' => 'John Updated']);
```

#### **8. `delete(string $url, array $param = [])`**
Effectue une requÃªte DELETE. Cette mÃ©thode utilise `PUT` en interne avec le paramÃ¨tre `_method` pour simuler une requÃªte DELETE.

```php
$response = $test->delete('/api/users/1');
```

#### **9. `patch(string $url, array $param = [])`**
Effectue une requÃªte PATCH. Comme pour `delete()`, cette mÃ©thode utilise `PUT` en interne.

```php
$response = $test->patch('/api/users/1', ['name' => 'John Modified']);
```

#### **10. `visit(string $method, string $url, array $params = [])`**
Effectue une requÃªte HTTP gÃ©nÃ©rique en fonction de la mÃ©thode spÃ©cifiÃ©e (`get`, `post`, `put`, etc.).

```php
$response = $test->visit('get', '/api/users');
```

### **Exemple complet d'utilisation**

Voici un exemple complet qui montre comment configurer un test fonctionnel avec l'API de test :

```php
use Bow\Testing\TestCase;

class UserApiTest extends TestCase
{
    protected ?string $url = 'http://localhost:8080'

    public function testCreateUser()
    {
        // Ajouter un en-tÃªte d'autorisation
        $this->withHeader('Authorization', 'Bearer token');

        // Ajouter des donnÃ©es de test Ã  envoyer dans la requÃªte POST
        $data = [
            'name' => 'John Doe',
            'email' => 'john.doe@example.com'
        ];

        // Effectuer la requÃªte POST
        $response = $this->post('/api/users', $data);

        // VÃ©rifier que la rÃ©ponse a le statut HTTP 201
        $response->assertStatus(201);
        $result = $response->toArray();

        // VÃ©rifier que le nom de l'utilisateur crÃ©Ã© est correct
        $this->assertEquals('John Doe', $result['name']);
    }

    public function testGetUser()
    {
        // Faire une requÃªte GET pour rÃ©cupÃ©rer un utilisateur
        $response = $this->get('/api/users/1');

        // VÃ©rifier que la rÃ©ponse a le statut HTTP 200
        $response->assertStatus(200);
        $result = $response->toArray();

        // VÃ©rifier que l'ID de l'utilisateur est correct
        $this->assertEquals(1, $result['id']);
    }
}
```

La classe `Response` permet de manipuler les rÃ©ponses HTTP dans le cadre de tests fonctionnels avec BowPHP. Elle encapsule un objet de la classe `HttpClientResponse` et expose plusieurs mÃ©thodes pour effectuer des assertions sur la rÃ©ponse.

## **Classe `Response` pour les Tests Fonctionnels**

### Introduction
La classe `Response` est utilisÃ©e pour reprÃ©senter une rÃ©ponse HTTP dans le cadre des tests fonctionnels dans BowPHP. Elle permet d'effectuer des assertions sur le contenu de la rÃ©ponse, son en-tÃªte, son type de contenu et son code de statut.

### **MÃ©thodes de la classe `Response`**

#### **1. `assertJson(string $message = ''): Response`**
VÃ©rifie que le contenu de la rÃ©ponse est au format JSON. Si ce n'est pas le cas, un Ã©chec de test sera gÃ©nÃ©rÃ©.

```php
$response->assertJson("La rÃ©ponse devrait Ãªtre au format JSON");
```

#### **2. `assertExactJson(array $data, string $message = ''): Response`**
VÃ©rifie que le contenu JSON de la rÃ©ponse correspond exactement aux donnÃ©es spÃ©cifiÃ©es.

```php
$response->assertExactJson([
    'name' => 'John Doe',
    'email' => 'john.doe@example.com'
], "La rÃ©ponse JSON ne correspond pas aux donnÃ©es attendues.");
```

#### **3. `assertContainsExactText(string $data, string $message = ''): Response`**
VÃ©rifie que le contenu de la rÃ©ponse correspond exactement au texte donnÃ©.

```php
$response->assertContainsExactText("Bienvenue, John Doe", "Le texte de la rÃ©ponse ne correspond pas.");
```

#### **4. `assertHeader(string $header, string $message = ''): Response`**
VÃ©rifie qu'un en-tÃªte spÃ©cifique existe dans la rÃ©ponse.

```php
$response->assertHeader('Content-Type', "L'en-tÃªte Content-Type est manquant.");
```

#### **5. `assertArray(string $message = ''): Response`**
VÃ©rifie que le contenu de la rÃ©ponse est un tableau.

```php
$response->assertArray("La rÃ©ponse devrait Ãªtre un tableau.");
```

#### **6. `assertContentType(string $content_type, string $message = ''): Response`**
VÃ©rifie que le type de contenu de la rÃ©ponse correspond Ã  celui spÃ©cifiÃ©.

```php
$response->assertContentType('application/json', "Le type de contenu n'est pas 'application/json'.");
```

#### **7. `assertContentTypeJson(string $message = ''): Response`**
VÃ©rifie que le type de contenu est `application/json`.

```php
$response->assertContentTypeJson("Le type de contenu devrait Ãªtre JSON.");
```

#### **8. `assertContentTypeText(string $message = ''): Response`**
VÃ©rifie que le type de contenu est `text/plain`.

```php
$response->assertContentTypeText("Le type de contenu devrait Ãªtre text/plain.");
```

#### **9. `assertContentTypeHtml(string $message = ''): Response`**
VÃ©rifie que le type de contenu est `text/html`.

```php
$response->assertContentTypeHtml("Le type de contenu devrait Ãªtre text/html.");
```

#### **10. `assertContentTypeXml(string $message = ''): Response`**
VÃ©rifie que le type de contenu est `text/xml`.

```php
$response->assertContentTypeXml("Le type de contenu devrait Ãªtre text/xml.");
```

#### **11. `assertStatus(int $code, string $message = ''): Response`**
VÃ©rifie que le code de statut HTTP de la rÃ©ponse correspond Ã  celui spÃ©cifiÃ©.

```php
$response->assertStatus(200, "Le statut HTTP n'est pas 200.");
```

#### **12. `assertKeyExists(string $key, string $message = ''): Response`**
VÃ©rifie qu'une clÃ© existe dans le contenu JSON de la rÃ©ponse.

```php
$response->assertKeyExists('id', "La clÃ© 'id' est manquante dans la rÃ©ponse.");
```

#### **13. `assertKeyMatchValue(string|int $key, mixed $value, string $message = ''): Response`**
VÃ©rifie qu'une clÃ© spÃ©cifique dans le contenu JSON de la rÃ©ponse correspond Ã  une valeur spÃ©cifiÃ©e.

```php
$response->assertKeyMatchValue('name', 'John Doe', "Le nom dans la rÃ©ponse ne correspond pas.");
```

#### **14. `assertContains(string $text): Response`**
VÃ©rifie que le contenu de la rÃ©ponse contient une sous-chaÃ®ne spÃ©cifique.

```php
$response->assertContains("Bienvenue", "Le texte 'Bienvenue' devrait Ãªtre prÃ©sent.");
```

#### **15. `getContent(): string`**
RÃ©cupÃ¨re le contenu brut de la rÃ©ponse.

```php
$content = $response->getContent();
```

#### **16. `toArray(): array|object`**
Retourne le contenu de la rÃ©ponse sous forme de tableau ou d'objet (si le contenu est JSON).

```php
$data = $response->toArray();
```

#### **17. `__call(string $method, array $params = [])`**
Permet d'appeler dynamiquement les mÃ©thodes de l'objet `HttpClientResponse` encapsulÃ© dans la rÃ©ponse.

```php
$response->getCode(); // Appelle getCode() sur HttpClientResponse
```

### **Exemple d'utilisation complÃ¨te**

Voici un exemple complet qui montre comment utiliser la classe `Response` pour tester une API :

```php
use Bow\Testing\TestCase;

class UserApiTest extends TestCase
{
    public function testCreateUser()
    {
        // Effectuer une requÃªte POST
        $data = [
            'name' => 'John Doe',
            'email' => 'john.doe@example.com'
        ];
        $response = $this->post('/api/users', $data);

        // VÃ©rifier que la rÃ©ponse a le statut 201
        $response->assertStatus(201, "Le statut HTTP devrait Ãªtre 201");

        // VÃ©rifier que le contenu est en JSON
        $response->assertJson("La rÃ©ponse devrait Ãªtre en JSON");

        // VÃ©rifier que le nom dans la rÃ©ponse est correct
        $response->assertKeyMatchValue('name', 'John Doe', "Le nom de l'utilisateur est incorrect.");
    }

    public function testGetUser()
    {
        // Effectuer une requÃªte GET
        $response = $this->get('/api/users/1');

        // VÃ©rifier que la rÃ©ponse a le statut 200
        $response->assertStatus(200, "Le statut HTTP devrait Ãªtre 200");

        // VÃ©rifier que l'utilisateur existe
        $response->assertKeyExists('id', "L'ID de l'utilisateur devrait exister.");
    }
}
```

### RÃ©fÃ©rences

- [Documentation officielle de PHPUnit](https://phpunit.de/)

Ce document peut Ãªtre inclus dans la documentation officielle pour aider les utilisateurs de BowPHP Ã  comprendre et Ã  utiliser l'API de test fonctionnel de maniÃ¨re optimale.

<SuggestionFeature />
