---
id: controller
title: "ðŸ‘¨ðŸ½â€âœˆï¸ ContrÃ´leurs"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

## Introduction

Les contrÃ´leurs sont des moyens pour simplifier l'organisation de votre projet.

Au lieu de dÃ©finir toute la logique de gestion de la requÃªte en tant que `closure` dans les fichiers de routage, vous pouvez organiser ce comportement Ã  l'aide de classe de contrÃ´leur. Les contrÃ´leurs peuvent regrouper la logique de traitement des requÃªtes associÃ©e en une seule classe.

Les contrÃ´leurs sont stockÃ©s dans le rÃ©pertoire `app/Controllers`.

[![asciicast](https://asciinema.org/a/1r0hZPnP5wY5fCPcxNXtLTQ4r.svg)](https://asciinema.org/a/1r0hZPnP5wY5fCPcxNXtLTQ4r)

## Configuration

Vous avez la possibilitÃ© de modifier le `namespace` des contrÃ´leurs et des middlewares. Pour ce faire, ouvrez le fichier `app\Kernel.php`. La mÃ©thode `namespaces` permet Ã  Bow de savoir quel est le bon `namespace` Ã  ajouter sur le contrÃ´leur lors de l'exÃ©cution de la requÃªte ou lors de la gÃ©nÃ©ration de contrÃ´leur ou de middleware par le lanceur de tÃ¢che `php bow`.

Imaginez que vous avez une application pour la gestion des bus d'une Ã©cole et que vous voulez grouper tous vos contrÃ´leurs dans le namespace `App\Bus\Controllers`. Alors comment faire Ã§a ?

Voici le code que cela pourrait donner :

```php title="app\Kernel.php"
public function namespaces()
{
  return [
    "controller" => "App\\Bus\\Controllers",
    ...
  ]
}
```

Ensuite, il faudra aussi changer un peu la configuration du lanceur de tÃ¢che :

```php title="Dans le fichier bow"
$command = new Bow\Console\Command(__DIR__);
$command->setControllerDirectory(__DIR__.'/app/Bus/Controllers');
```

> Visitez ce [lien](./structure) pour plus d'information sur la personnalisation de la structure de l'application.

## ContrÃ´leur de base

### DÃ©finir un contrÃ´leur

Voici un exemple de classe de contrÃ´leur de base. Notez que le contrÃ´leur hÃ©rite de la classe `App\Controllers\Controller` de base. Cette classe de base fournit quelques mÃ©thodes pratiques telles que la mÃ©thode du `render`, qui peut Ãªtre utilisÃ©e pour compiler une vue.

```php
namespace App\Controllers;

use App\Controllers\Controller;
use App\Models\User;

class UserController extends Controller
{
  /**
   * Afficher le profil pour l'utilisateur donnÃ©.
   *
   * @param int $id
   * @return mixed
   */
  public function show($id)
  {
    return $this->render('user/profile', ['user' => User::findOrFail($id)]);
  }
}
```

Vous pouvez dÃ©finir une route dans le fichier `routes/app.php` vers cette mÃ©thode de contrÃ´leur comme suit :

```php
$app->get('user/:id', 'UserController::show');
```

DÃ©sormais, lorsqu'une demande correspond Ã  l'URI de la route spÃ©cifiÃ©e, la mÃ©thode `show` de la classe `UserController` sera exÃ©cutÃ©e. Bien entendu, les paramÃ¨tres de la route seront Ã©galement transmis Ã  la mÃ©thode.

Vous pouvez gÃ©nÃ©rer un contrÃ´leur en utilisant la commande `add:controller` de `php bow`:

```bash
php bow add:controller UserController
```

### ContrÃ´leur et espaces de noms

Il est trÃ¨s important de noter que nous n'avons pas eu besoin de spÃ©cifier le `namespace` complet du contrÃ´leur lors de la dÃ©finition de la route. Ã‰tant donnÃ© que `public/index.php` charge vos fichiers de route dans un groupe de routage contenant le `namespace`, nous avons uniquement spÃ©cifiÃ© la partie du nom de classe qui vient aprÃ¨s la partie `App\Controllers` du `namespace`.

Si vous choisissez d'imbriquer vos contrÃ´leurs plus profondÃ©ment dans le rÃ©pertoire `App\Controllers`, utilisez le nom de classe spÃ©cifique relatif au `namespace` racine `App\Controllers`. Donc, si votre classe de contrÃ´leur complÃ¨te est `App\Controllers\Photo\AdminController`, vous devez enregistrer les routes sur le contrÃ´leur comme suit :

```php
$app->get('/foo', 'Photo\AdminController::action');
```

Vous pouvez gÃ©nÃ©rer un contrÃ´leur en utilisant la commande `add:controller` de `php bow`:

```bash
php bow add:controller Photo/AdminController
```

:::note
Remarquez bien le nom du dossier : il est en camel case. Le framework crÃ©era le namespace appropriÃ© pour la classe `AdminController` qui sera `namespace App\Controllers\Photo;`. Vous trouverez le contrÃ´leur dans le dossier `app/Controllers/Photo/AdminController.php`.
:::

Plus d'information sur le [routing](./routing).

### ContrÃ´leur et middleware

Les middlewares peuvent Ãªtre assignÃ©s Ã  la route du contrÃ´leur dans vos fichiers de route. Le middleware est stockÃ© dans le dossier `app\Middlewares`. Pour plus d'informations sur les middlewares, visitez ce [lien](./middleware).

Exemple :

```php
$app->get('profile', 'UserController::show')->middleware('auth');
```

## ContrÃ´leur REST

Les contrÃ´leurs REST sont un moyen simple pour mettre en place une API Rest. Cette approche vous permet de vous concentrer sur votre logique et de laisser le framework gÃ©rer le routage pour vous.

### DÃ©finir un contrÃ´leur REST

Pour dÃ©finir un nouveau contrÃ´leur REST, vous devez utiliser le lanceur de tÃ¢che `php bow` avec la commande `generate:resource` dans votre console :

```bash
php bow generate:resource PetController
```

Un contrÃ´leur nommÃ© `PetController` sera donc crÃ©Ã©. Ce qui fait sa particularitÃ©, c'est qu'il y a dÃ©jÃ  des mÃ©thodes prÃ©dÃ©finies et ces mÃ©thodes doivent rester telles quelles.

```php
namespace App\Controllers;

use App\Controllers\Controller;
use App\Models\Pet;

class PetController extends Controller
{
  /**
   * Point d'entrÃ©e
   *
   * @return void
   */
  public function index()
  {
    // Codez Ici
  }

  /**
   * Permet d'afficher la vue permettant de crÃ©er une rÃ©source.
   *
   * @return void
   */
  public function create()
  {
    // Codez Ici
  }

  /**
   * Permet d'ajouter une nouvelle ressource dans la base de donnÃ©es
   *
   * @return void
   */
  public function store()
  {
    // Codez Ici
  }

  /**
   * Permet de rÃ©cupÃ©rer une information prÃ©cise avec un identifiant
   *
   * @param mixed $id
   * @return void
   */
  public function show($id)
  {
    // Codez Ici
  }

  /**
   * Mise Ã  jour d'une ressource en utilisant les paramÃ¨tres GET
   *
   * @param mixed $id
   * @return void
   */
  public function edit($id)
  {
    // Codez Ici
  }

  /**
   * Mise Ã  jour d'une rÃ©source
   *
   * @param mixed $id
   * @return void
   */
  public function update($id)
  {
    // Codez Ici
  }

  /**
   * Permet de supprimer une ressource
   *
   * @param mixed $id
   * @return void
   */
  public function destroy($id)
  {
    // Codez Ici
  }
}
```

### Utiliser le contrÃ´leur REST

Pour utiliser le contrÃ´leur REST, vous devez utiliser la mÃ©thode `rest` sur la variable globale `$app` dans vos fichiers de [routing](./routing).

#### Prototype de la mÃ©thode `rest`

```php
$app->rest(url, action, where = []);
```

| ParamÃ¨tre | Type |
|----------|------|
| `url` | `String`, `Array` - Le nom de la route |
| `action` | `String` - Le nom du contrÃ´leur |
| `where` | `Array` - Contrainte sur la variable `id` |

#### Utilisation simple

Et Ã§a donne ceci :

```php
$app->rest('pets', 'PetController');
```

#### Utilisation avec les contraintes

Avec une contrainte Ã§a donne ceci:

```php
$app->rest('pets', 'PetController', ['id' => '\d+']);
```

Ici la contrainte s'applique sur toutes les mÃ©thodes. Mais, vous avez aussi la possibilitÃ© de restreindre les contraintes sur des mÃ©thodes comme ceci :

```php
$app->rest('pets', 'PetController', [
  'show' => ['id' => '\d+'],
  'edit' => ['id' => '[a-z]+'],
]);
```

#### Utilisation via un tableau comme action

Dans le cas ou `action` est un `array` voici les clÃ©s/valeurs possibles.

```php
$action = [
  'controller' => 'PetController',
  'ignores' => ['index', 'create'],
];

$app->rest('pets', $action, ['id' => '\d+']);
```

#### Ignorer des mÃ©thodes

La valeur de `ignores` sera une liste de mÃ©thodes/URLs qui seront ignorÃ©es par le routeur. Ainsi, dans l'exemple prÃ©cÃ©dent, les mÃ©thodes `index` et `create` seront indisponibles.

#### URL et action

En considÃ©rant la dÃ©finition REST suivante :

```php
$action = [
  'controller' => 'PetController',
  'ignores' => ['index', 'create'],
];

$app->rest('pets', $action, ['id' => '\d+']);
```

| URL | MÃ©thode HTTP | Nom de la route | Description |
|----------|------|------|------|
| `/pets` | `GET` | `pets.index` | Retourne la liste des pets |
| `/pets` | `POST` | `pets.store` | Permet d'ajouter un autre pet |
| `/pets/:id` | `GET` | `pets.show` | Afficher un seul pet |
| `/pets/:id` | `PUT/PATCH` | `pets.update` | Permet de mettre Ã  jour les informations d'un pet |
| `/pets/:id` | `DELETE` | `pets.delete` | Ceci va supprimer un pet |
| `/pets/create` | `GET` | `pets.create` | Permet d'afficher le formulaire d'ajout |

<SuggestionFeature />
