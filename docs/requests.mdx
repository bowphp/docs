---
id: http-request
title: "ğŸš€ Request"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

## Introduction

:::info Ã€ propos des requÃªtes HTTP
Une requÃªte HTTP est le message que l'utilisateur envoie Ã  l'application Bow via son navigateur ou d'autres outils tels que `curl`, `httpie`, etc.
:::

Ce message est traitÃ© par Bow Ã  travers la classe [`Bow\Http\Request`](https://bowphp.com/api/5.x/Bow/Http/Request.html). Cette classe vous permet d'avoir les informations sur la requÃªte envoyÃ©e par l'utilisateur comme son adresse IP, le type du message, les informations d'un formulaire, etc.

## AccÃ©der Ã  la requÃªte

Pour capturer un message ou requÃªte HTTP, vous pouvez premiÃ¨rement utiliser le helper `request()` qui vous donne une instance de [`Bow\Http\Request`](https://bowphp.com/api/5.x/Bow/Http/Request.html), deuxiÃ¨mement vous pouvez passer par l'injecteur de dÃ©pendance via une action de contrÃ´leur.

## RÃ©cupÃ©ration des donnÃ©es

En utilisant quelques mÃ©thodes simples, vous pouvez accÃ©der Ã  toutes les entrÃ©es utilisateur de votre application.

### Via des Closures de route

- Avec le helper `request`:

```php
$app->get('/', function () {
  $request = request();

  $name = $request->get('name');
  // code ici
});
```

- Par l'injection de dÃ©pendance

```php title="routes/app.php"
use Bow\Http\Request;

$app->get('/', function (Request $request) {
  return $request->get('name');
});
```

### Via un controller

Si votre mÃ©thode de contrÃ´leur attend Ã©galement une entrÃ©e d'un paramÃ¨tre de route, vous devez rÃ©pertorier les paramÃ¨tres de votre route aprÃ¨s vos autres dÃ©pendances. Par exemple, si votre route est dÃ©finie comme suit :

```php
$app->get('/users/:id', 'UserController::show');
```

Vous pouvez toujours taper la requÃªte [Bow\Http\Request](https://bowphp.com/api/5.x/Bow/Http/Request.html) et accÃ©der Ã  l'id de votre paramÃ¨tre de route en dÃ©finissant votre mÃ©thode de contrÃ´leur comme suit:

```php
namespace App\Controllers;

use App\Controllers\Controller;
use App\Models\User;
use Bow\Http\Request;

class UserController extends Controller
{
  /**
   * Afficher le profil pour l'utilisateur donnÃ©
   *
   * @param Request $request
   * @return mixed
   */
  public function show(Request $request, $id)
  {
    $user = User::where('id', $id)->first();

    $user->name = $request->get('name');

    $user->save();

    return $this->render('user/profile', ['user' => $user]);
  }
}
```

## Chemin de requÃªte et mÃ©thode

### RÃ©cupÃ©rer le chemin de requÃªte

La mÃ©thode `path` renvoie les informations de chemin de la requÃªte. Ainsi, si la requÃªte entrante est ciblÃ©e sur `http://example.com/bar/zar`, la mÃ©thode path retournera `bar/zar`:

```php
$uri = $request->path();
```

La mÃ©thode `is` vous permet de vÃ©rifier que le chemin de requÃªte entrant correspond Ã  un modÃ¨le donnÃ©. Vous pouvez utiliser le caractÃ¨re `*` comme caractÃ¨re gÃ©nÃ©rique lorsque vous utilisez cette mÃ©thode:

```php
if ($request->is('users/*')) {
  //
}
```

### RÃ©cupÃ©rer la mÃ©thode de requÃªte

La mÃ©thode `method` retournera le verbe HTTP pour la requÃªte. Vous pouvez utiliser les mÃ©thodes `isPost`, `isGet`, `isPut`, `isDelete`, `isOptions`, `isPatch` pour vÃ©rifier que le verbe HTTP correspond Ã  une mÃ©thode HTTP de la requÃªte donnÃ©e :

```php
$method = $request->method();

if ($request->isPost()) {
  $filename = $request->file('filename');
  $filename->moveTo('/some/directory');
}
```

### VÃ©rifier si la requÃªte est en AJAX

Pour dÃ©terminer si une requÃªte a Ã©tÃ© envoyÃ©e via AJAX, la mÃ©thode `isAjax` vous permet de vÃ©rifier cela.

```php
if ($request->isAjax()) {
  //
}
```

### VÃ©rifier si la requÃªte attend une rÃ©ponse JSON

La mÃ©thode `wantsJson` vous permet de vÃ©rifier si la requÃªte attend une rÃ©ponse au format JSON. Souvent, les requÃªtes AJAX sont envoyÃ©es avec l'en-tÃªte `Accept: application/json`, la mÃ©thode `wantsJson` vÃ©rifie si cet en-tÃªte est prÃ©sent dans la requÃªte.

```php
if ($request->wantsJson()) {
  // code ici
}
```

### RÃ©cupÃ©rer une entrÃ©e

Souvent, la requÃªte envoyÃ©e par le client HTTP contient des donnÃ©es souvent demandÃ©es pour actionner un mÃ©canisme, par exemple celui d'une inscription.

:::info Optimisation des donnÃ©es
Bow Framework, dans son dÃ©marrage, optimise les donnÃ©es envoyÃ©es au serveur en remplaÃ§ant les valeurs vides par `null` et en supprimant les espaces dans les valeurs de chaque champ avec la fonction PHP `trim`.
:::

```php
$name = $request->get('name');

// RÃ©cupÃ©rer directement la valeur via le nom du champ
$name = $request->name;
```

:::tip Valeur par dÃ©faut
Vous pouvez aussi dÃ©finir une valeur par dÃ©faut Ã  `get`.
:::

```php
$name = $request->get('name', 'Papac');

$name = $request->get('name', function () {
  return User::first()->name;
});
```

Ceci permet justement de rÃ©cupÃ©rer le contenu du champ `name` d'un formulaire ou d'une URL en fonction du type de requÃªte.

### RÃ©cupÃ©ration d'une partie des donnÃ©es d'entrÃ©e

Si vous devez extraire un sous-ensemble des donnÃ©es d'entrÃ©e, vous pouvez utiliser les mÃ©thodes `ignore` et `only`. Ces deux mÃ©thodes acceptent un seul tableau ou une liste d'arguments dynamique:

```php
$input = $request->only(['name', 'lastname']);

$input = $request->only('name', 'lastname');

$input = $request->ignore(['password']);

$input = $request->ignore('password');
```

### DÃ©terminer si une valeur d'entrÃ©e est prÃ©sente

Vous devez utiliser la mÃ©thode `has` pour dÃ©terminer si une valeur est prÃ©sente sur la requÃªte. La mÃ©thode `has` renvoie `true` si la valeur est prÃ©sente dans la requÃªte:

```php
if ($request->has('name')) {
  //
}
```

### DÃ©terminer l'adresse IP du client

Souvent, vous allez vouloir rÃ©cupÃ©rer l'adresse IP du client ayant envoyÃ© la requÃªte. La mÃ©thode `ip` permet, comme son nom l'indique, de rÃ©cupÃ©rer l'adresse IP du client :

```php
$ip = $request->ip();

if ($ip == 'xxx.xxx.xxx.xxx') {
  // code ici
}
```

### DÃ©terminer le port du client

La mÃ©thode `port` permet, comme son nom l'indique, de rÃ©cupÃ©rer le port du client :

```php
$port = $request->port();

// Code ici
```

### DÃ©terminer le protocole du client

La mÃ©thode `protocol` permet, comme son nom l'indique, de rÃ©cupÃ©rer le protocole du client :

```php
$protocol = $request->protocol();

// Code ici
```

Il y a aussi la mÃ©thode `isProtocol` qui permet de faire de la vÃ©rification sur le protocole :

```php
if ($request->isProtocol('http')) {
  //
}
```

Et `isSecure` vous permet de vÃ©rifier si la requÃªte est sÃ©curisÃ©e.

```php
if ($request->isSecure()) {
  //
}
```

### RÃ©cupÃ©rer les en-tÃªtes HTTP

Vous avez la possibilitÃ© de rÃ©cupÃ©rer les [en-tÃªtes HTTP](https://developer.mozilla.org/fr/docs/Web/HTTP/Headers) du client avec la mÃ©thode `getHeader` et `hasHeader` pour vÃ©rifier l'existence d'un en-tÃªte HTTP.

```php
$header = $request->getHeader('content-type');

echo $header;
// text/html

if ($request->hasHeader('x-proxy-key')) {
  // code ici
}
```

### RÃ©cupÃ©rer l'IP du serveur

Vous avez la possibilitÃ© de rÃ©cupÃ©rer l'adresse IP du serveur sur lequel votre application Bow est hÃ©bergÃ©e.

```php
$hostname = $request->hostname();

echo $hostname;
// exemple.com
```

### RÃ©cupÃ©rer le domaine Origin

Le domaine dit `origin` est l'adresse rÃ©cupÃ©rÃ©e avec la mÃ©thode `hostname` ensuite associÃ©e au protocole de la requÃªte.

```php
$hostname = $request->origin();

echo $hostname;
// https://exemple.com
```

### RÃ©cupÃ©rer le temps de la requÃªte

Il est souvent intÃ©ressant de voir combien de temps a pris une requÃªte. La mÃ©thode `time` permet de le faire et elle retourne un timestamp.

```php
$time = $request->time();

echo $time;
```

### RÃ©cupÃ©rer une instance de la session

Il est souvent intÃ©ressant de manipuler la session directement. La mÃ©thode `session` permet de le faire et elle retourne l'instance de la session.

```php
$session = $request->session();

var_dump($session);
```

:::info En savoir plus
Pour plus d'informations sur la session, visitez la page [HTTP Session](./session).
:::

### RÃ©cupÃ©rer l'authentification courante

Vous pouvez aussi avoir l'authentification en cours si vous avez utilisÃ© le systÃ¨me d'authentification native de Bow Framework.

```php
$user = $request->user();

// DÃ©finir le guard
$user = $request->user('api');
```

<SuggestionFeature />
