---
id: views
title: "üé® Utiliser les vues"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

## Introduction

:::info
Les vues contiennent le code HTML fourni par votre application et s√©parent votre logique de contr√¥leur/application de votre logique de pr√©sentation.
:::

<script id="asciicast-srlT0uYy1bOin8Z3Z35E66JJB" src="https://asciinema.org/a/srlT0uYy1bOin8Z3Z35E66JJB.js" data-speed="3" data-rows="20" async></script>

## Configuration

:::tip Moteurs de template
Bow Framework impl√©mente 2 moteurs de template et le template par d√©faut est **[Tintin](./tintin)**.
:::

La configuration des vues se trouve dans le fichier `view.php` du dossier `config/`.

Sp√©cifiez le nom du template √† utiliser avec l'option `engine` de la configuration, cette option peut prendre les valeurs suivantes : `tintin`, `twig` et `php`. Par d√©faut Bow utilise `tintin`.

:::warning Remarque
Notez que si vous d√©finissez `php`, le rendu des vues se fera sans moteur de template.
:::

Vous pouvez aussi changer l'extension de template en modifiant la valeur de l'entr√©e `extension`. Vous verrez √©galement que les vues sont stock√©es dans le r√©pertoire `templates` par d√©faut.

## Cr√©ation de vue

Une simple vue peut ressembler √† ceci :

```html
<!-- View stored in templates/greeting.tintin.php -->
<html>
  <body>
    <h1>Hello, {{ $name }}</h1>
  </body>
</html>
```

Apr√®s avoir modifi√© et sauvegard√© votre vue dans `templates/greeting.tintin.php`, vous pouvez maintenant l'envoyer aux utilisateurs avec le helper `view` comme ceci :

```php
$app->get('/', function() {
  return view('greeting', ['name' => 'Tintin']);
});
```

### Utilisation

Exemple d'utilisation (avec la classe `View`).
Cette m√©thode utilise `parse`.

```php
View::parse(view, data, status)
```

| Param√®tre | type | description|
|-----------|------|------------|
| `view`      | `String` | Le chemin de la vue sachant que le moteur se base sur le dossier des vues|
| `data`      | `Array`, `Object` | Les donn√©es √† passer √† la vue|
| `status`    | `Integer` | Le code http |

```php
use Bow\View\View;

echo View::parse('nom-de-la-vue-sans-extension');
```

Pour passer des variables √† la vue

```php
use Bow\View\View;

echo View::parse('nom-de-la-vue-sans-extension', ['name' => 'bow'], 200);
```

:::tip Helper
Vous pouvez utiliser le helper `view` qui s'utilise de la m√™me fa√ßon.
:::

Avec la vue suivante :

```html
<!-- View stored in templates/greeting.tintin.php -->
<html>
 <body>
  <h1>Hello, {{ $name }}</h1>
 </body>
</html>
```

Exemple dans un contr√¥leur :

```php
namespace App\Controllers;

use App\Controllers\Controller;

class HomeController extends Controller
{
  /**
   * Show hello page
   *
   * @return mixed
   */
  public function show()
  {
    return view('greeting', ['name' => 'Bowphp']);
    // Ou
    return $this->render('greeting', ['name' => "Bowphp"]);
    // Ou
    return response()->render('greeting', ['name' => "Bowphp"]);
  }
}
```

## Introduction Tintin

:::info Tintin
Tintin est un template PHP qui se veut tr√®s simple et extensible. Il peut √™tre utilisable dans n'importe quel projet PHP. Par d√©faut, Tintin est le moteur de template utilis√© par Bow Framework.
:::

```t
Hello, {{ $name }}.
```

Bien entendu, vous n'√™tes pas limit√© √† afficher le contenu des variables transmises √† la vue. Vous pouvez √©galement faire √©cho aux r√©sultats de toute fonction PHP. En fait, vous pouvez ins√©rer n'importe quel code PHP dans une instruction echo Tintin:

```t
Hello, {{ strtoupper($name) }}.
```

> Les instructions Tintin `{{ }}` sont automatiquement envoy√©es via la fonction PHP `htmlspecialchars` pour emp√™cher les attaques XSS.

### Affichage des donn√©es non √©chapp√©es

Par d√©faut, les instructions Tintin `{{ }}` sont automatiquement envoy√©es via la fonction PHP `htmlspecialchars` pour emp√™cher les attaques XSS. Si vous ne souhaitez pas que vos donn√©es soient prot√©g√©es, vous pouvez utiliser la syntaxe suivante:

```t
Hello, {{{ $name }}}.
```

### Ajouter un commentaire

Cette clause `{## ##}` permet d'ajouter un commentaire √† votre code `tintin`.

```t
{## This comment will not be present in the rendered HTML ##}
```

## La directive %verbatim

Si vous affichez des variables JavaScript dans une grande partie de votre mod√®le, vous pouvez envelopper le code HTML dans la directive `%verbatim` afin de ne pas avoir √† pr√©fixer chaque instruction Tintin echo avec un symbole `%` :

```t
%verbatim
  <div class="container">
    Hello, {{ name }}.
  </div>
%endverbatim
```

## les directives `%if`

Ce sont les clauses qui permettent d'√©tablir des branchements conditionnels comme dans la plupart des langages de programmation.

Vous pouvez construire des instructions if en utilisant les directives `%if`, `%elseif`, `%elif`, `%else` et `%endif`. Ces directives fonctionnent de la m√™me mani√®re que leurs homologues PHP¬†:

```t
%if ($name == 'tintin')
  {{ $name }}
%elseif ($name == 'template')
  {{ $name }}
%else
  {{ $name }}
%endif
```

> Vous pouvez utiliser `%elif` √† la place de `%elseif`.

Petite sp√©cificit√©, le `%unless` quant √† lui, il permet de faire une condition inverse du `%if`.
Pour faire simple, voici un exemple:

```t
%unless ($user->isAdmin())
  // do something else
$endunless
```

En plus des directives conditionnelles d√©j√† discut√©es, les directives `%isset`, `%empty`, `%notempty` peuvent √™tre utilis√©es comme raccourcis pratiques pour leurs fonctions PHP respectives¬†:

```t
%isset($records)
  // $records is defined and is not null...
%endisset

%empty($records)
  // $records is "empty"...
%endempty

%notempty($records)
  // $records is not "empty"...
%notendempty
```

> Vous pouvez ajouter `%esle` pour effectuer une action contraire

## Les directives `%loop` / `%for` / `%while`

Souvent vous pouvez √™tre amener √† faire des listes ou r√©p√©titions sur des √©l√©ments. Par exemple, afficher tout les utilisateurs de votre plateforme.

### L'utilisation de `%loop`

Cette clause faire exactement l'action de `foreach`.

```t
%loop($names as $name)
  Bonjour {{ $name }}
%endloop
```

Cette clause peux √™tre aussi coupler avec tout autre clause telque `%if`.
Un exemple rapide.

```t
%loop($names as $name)
  %if($name == 'tintin')
    Bonjour {{ $name }}
    %stop
  %endif
%endloop
```

Vous avez peut-√™tre remarquer le `%stop` il permet de stoper l'√©x√©cution de la boucle. Il y a aussi son conjoint le `%jump`, lui parcontre permet d'arr√™ter l'√©x√©cution √† son niveau et de lancer s'√©x√©cution du prochain tour de la boucle.

### Les sucres syntaxiques `%jump` et `%stop`

Souvent le d√©v√©loppeur est amen√© √† faire des conditions d'arr√™t de la boucle `%loop` comme ceci:

```t
%loop($names as $name)
  %if($name == 'tintin')
    %stop
    // Ou
    %jump
  %endif
%endloop
```

Avec les sucres syntaxique, on peut r√©duire le code comme ceci:

```t
%loop($names as $name)
  %stop($name == 'tintin')
  // Ou
  %jump($name == 'tintin')
%endloop
```

### L'utilisation de `%for` et `%while`

Cette clause faire exactement l'action de `for`.

```t
%for($i = 0; $i < 10; $i++)
 // ..
%endfor
```

Cette clause faire exactement l'action de `while`.

```t
%while($name != 'tintin')
 // ..
%endwhile
```

## Classes et styles conditionnels

La directive `%class` compile conditionnellement une cha√Æne de classe CSS. La directive accepte un tableau de classes o√π la cl√© du tableau contient la ou les classes que vous souhaitez ajouter, tandis que la valeur est une expression bool√©enne. Si l'√©l√©ment de tableau a une cl√© num√©rique, il sera toujours inclus dans la liste de classe rendue¬†:

```t
%php
  $isActive = false;
  $hasError = true;
%endphp

<span %class([
  'p-4',
  'font-bold' => $isActive,
  'text-gray-500' => ! $isActive,
  'bg-red' => $hasError,
])></span>
 
<span class="p-4 text-gray-500 bg-red"></span>
```

De m√™me, la directive `%style` peut √™tre utilis√©e pour ajouter conditionnellement des styles CSS en ligne √† un √©l√©ment HTML¬†:

```t
%php
  $isActive = true;
%endphp
 
<span %style([
    'background-color: red',
    'font-weight: bold' => $isActive,
])></span>
 
<span style="background-color: red; font-weight: bold;"></span>
```

## Inclure les sous-vues

Souvent lorsque vous d√©v√©loppez votre code, vous √™tes amener √† subdiviser les vues de votre application pour √™tre plus flexible et √©crire moin de code.

`%include` permet d'include un autre fichier de template dans un autre.

```t
<div id="container">
  %include('filename', %data)
</div>
```

Si vous essayez d'inclure une vue qui n'existe pas, Tintin lancera une erreur. Si vous souhaitez inclure une vue qui peut ou non √™tre pr√©sente, vous devez utiliser la directive `%includeIf`¬†:

```t
%includeIf("filename", ["name" => "Tintin"])
```

Si vous souhaitez `%include` une vue si une expression bool√©enne donn√©e est √©valu√©e comme vraie ou fausse, vous pouvez utiliser les directives `%includeWhen` et `%includeUnless`:

```t
%includeWhen($user->isAdmin(), "include-file-name", ["name" => "Tintin"])
```

## PHP brut

Dans certaines situations, il est utile d'int√©grer du code PHP dans vos vues. Vous pouvez utiliser la directive Tintin `%php` ou `%raw` pour ex√©cuter un bloc de PHP simple dans votre template:

```t
%php
  $counter = 1;
%endphp

%raw
  $counter = 1;
%endraw
```

## Flash session

Dans le cas ou vous voulez afficher un message flash directement vue vous pouvez utiliser `%flash`. Et pour v√©rifier si une message flash existe `%hasflash` et `%endhasflash` :

```t
%hasflash("error")
  <div class="alert alert-danger">
    %flash("error")
  </div>
%endhasflash
```

## Injection de services

La directive `%service` peut √™tre utilis√©e pour r√©cup√©rer un service du conteneur. Le premier argument pass√© √† `%service` est le nom de la variable dans laquelle le service sera plac√©, tandis que le second argument est le nom de la classe ou de l'interface du service que vous souhaitez r√©soudre¬†:

```t
%service('user_service', 'App\Services\UserService')
 
<div>
  %loop($user_service->all() as $user)
    <p>{{ $user->name }}</p>
  %endloop
</div>
```

## Directives d'authentification

Les directives `%auth` et `%guest` peuvent √™tre utilis√©es pour d√©terminer rapidement si l'utilisateur actuel est authentifi√© ou est un invit√©¬†:

```t
%auth
  // The user is authenticated...
%endauth
 
%guest
  // The user is not authenticated...
%endguest
```

Si n√©cessaire, vous pouvez sp√©cifier la garde d'authentification qui doit √™tre v√©rifi√©e lors de l'utilisation des directives `%auth` et `%guest` :

```t
%auth('admin')
  // The user is authenticated...
%endauth
 
%guest('admin')
  // The user is not authenticated...
%endguest
```

## Environment Guidelines

Vous pouvez v√©rifier si l'application s'ex√©cute dans l'environnement de production √† l'aide de la directive `%production`¬†:

```t
%production
  // Production specific content...
%endproduction
```

Ou, vous pouvez d√©terminer si l'application s'ex√©cute dans un environnement sp√©cifique √† l'aide de la directive `%env`¬†:

```t
%env('staging')
  // The application is running in "staging"...
%endenv

%env(['staging', 'production'])
  // The application is running in "staging" or "production"...
%endenv
```

## Champ CSRF

Chaque fois que vous d√©finissez un formulaire HTML dans votre application, vous devez inclure un champ de jeton CSRF masqu√© dans le formulaire afin que le middleware de protection CSRF puisse valider la demande. Vous pouvez utiliser la directive `%csrf` Tintin pour g√©n√©rer le champ de jeton¬†:

```t
<form method="POST" action="/profile">
  %csrf
</form>
```

## Champ M√©thode

√âtant donn√© que les formulaires HTML ne peuvent pas effectuer de requ√™tes `PUT`, `PATCH` ou `DELETE`, vous devrez ajouter un champ _method masqu√© pour usurper ces verbes HTTP. La directive `%method` Tintin peut cr√©er ce champ pour vous¬†:

```t
<form action="/foo/bar" method="POST">
  %method('PUT')
</form>
```

## H√©ritage avec %extends, %block et %inject

Comme tout bon syst√®me de template __tintin__ support le partage de code entre fichier. Ceci permet de rendre votre code flexible et maintenable.

Consid√©r√©rons le code __tintin__ suivant:

```t
# le fichier `layout.tintin.php`
<!DOCTYPE html>
<html>
<head>
  <title>Hello, world</title>
</head>
<body>
  <h1>Page header</h1>
  <div>
    %inject('content')
  </div>
  <p>Page footer</p>
</body>
</html>
```

Et aussi, on a un autre fichier qui h√©rite du code du fichier `layout.tintin.php`

```t
# le fichier se nomme `content.tintin.php`
%extends('layout')

%block('content')
  <p>This is the page content</p>
%endblock
```

### Explication

Le fichier `content.tintin.php` va h√©rit√© du code de `layout.tintin.php` et si vous r√©marquez bien, dans le fichier `layout.tintin.php` on a la clause `%inject` qui a pour param√®tre le nom du `%block` de `content.tintin.php` qui est `content`. Ce qui veut dire que le contenu du `%block` `content` sera remplac√© par `%inject`. Ce qui donn√©ra √† la fin ceci:

```html
<!DOCTYPE html>
<html>
<head>
  <title>Hello, world</title>
</head>
<body>
  <h1>Page header</h1>
  <div>
    <p>This is the page content</p>
  </div>
  <p>Page footer</p>
</body>
</html>
```

### Directive personnelis√©e

Tintin peut √™tre √©tendu avec son syst√™me de directive personnalis√©, pour ce faire utilis√© la m√©thode `directive`
Cr√©ons des directives pour g√©rer un formulaires:

```php
$tintin->directive('input', function (string $type, string $name, ?string $value) {
  return '<input type="'.$type.'" name="'.$name.'" value="'.$value.'" />';
});

$tintin->directive('button', function (string $type, string $label) {
  return '<button type="'.$type.'">'.$label.'"</button>';
});

$tintin->directive('form', function (string $action, string $method, string $enctype = "multipart/form-data") {
  return '<form action="'.$action.'" method="'.$method.'" enctype="'.$enctype.'">';
});

$tintin->directive('endform', function () {
  return '</form>';
});
```

Pour utiliser ces directives, rien de plus simple. Ecrivez le nom de la directive pr√©c√©d√© la par `%`. Ensuite si cette directive prend des param√®tres, lancer la directive comme vous lancez les fonctions dans votre programme.

```t
<div class="container">
  %form("/posts", "post", "multipart/form-data")
    %input("text", "name")
    %button('submit', 'Add')
  %endform
</div>
```

La compilation se fait comme d'habitude, pour plus d'information sur la [compilation](#utilisation).

```php
echo $tintin->render('form');
```

Sortie apr√®s compilation:

```html
<form action="/posts" method="post" enctype="multipart/form-data">
  <input type="text" name="name" value="" />
  <button type="submit">Add</button>
</form>
```

### Ajouter vos directives de la configuration

Dans le cas ou vous utilisez la configuration Tintin pour Bow Framework.
Changer le vos configuration dans le `ApplicationController::class` dans le dossier `app/Configurations`.

```php
namespace App\Configurations;

use Bow\Configuration\Loader as Config;

class ApplicationConfiguration extends Configuration
{
  /**
   * Launch configuration
   *
   * @param Config $config
   * @return void
   */
  public function create(Config $config): void
  {
    $tintin = app('view')->getEngine();

    $tintin->directive('super', function () {
      return "Super !";
    });
  }
}
```

Maintenant la directive `%super` est disponible et vous pouvez l'utiliser.

```php
return $tintin->render('%super');
// => Super !
```

## La directive `%macro`

Souvent, vous serez amen√© utiliser ou r√©utiliser un bloc de template pour optimiser l'√©criture de votre application. Alors les macros sont l√† pour cela.

> Les macros doivent √™tre d√©finies dans un fichier s√©par√©.

Pour vous utiliser les `%macro` vous devez passer en premier param√™tre le nom du macro et ensuite les param√™tres du macro.

Consid√©rons le fichier `user-macro.tintin.php`.

```t
%macro('users', array $users)
  %loop($users as $user)
    <div>{{ $user }}</div>
  %endloop
%endmacro
```

Pour utiliser le macro vous devez l'importer dans un autre fichier avec `%import`. Nous allons appeler le fichier `app.tintin.php` contenant le template suivant:

```t
%import('user-macro')

%extends('layout')

%block('content')
  <div class="container">
    {{ users($users) }}
  </div>
%endblock
```

Pour la compilation nous allons passer la liste des utilisateurs suivant:

```php
$users = ["franck", "lucien", "brice"];

$tintin->render('app', compact('users'));
```

Apr√®s compilation du fichier

```html
<div>franck</div>
<div>lucien</div>
<div>brice</div>
```

<SuggestionFeature />
