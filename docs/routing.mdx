---
id: routing
title: "üö¶ Routing"
---

- [Introduction](#introduction)
- [Mappage d'URL](#mappage-durl)
  - [Structure du Routage](#structure-du-routage)
  - [Exemple de Routage](#exemple-de-routage)
    - [Avec une Closure :](#avec-une-closure-)
    - [Avec un tableau de fonctions (callables) :](#avec-un-tableau-de-fonctions-callables-)
    - [Avec un contr√¥leur :](#avec-un-contr√¥leur-)
    - [Avec un contr√¥leur et un middleware :](#avec-un-contr√¥leur-et-un-middleware-)
    - [Utilisation d'un contr√¥leur avec la m√©thode `__invoke` :](#utilisation-dun-contr√¥leur-avec-la-m√©thode-__invoke-)
- [Liste des M√©thodes de Mappage](#liste-des-m√©thodes-de-mappage)
  - [Exemples de Routage avec diff√©rentes M√©thodes HTTP](#exemples-de-routage-avec-diff√©rentes-m√©thodes-http)
- [Mappage Multiple](#mappage-multiple)
  - [`match`: Mappage avec plusieurs M√©thodes HTTP](#match-mappage-avec-plusieurs-m√©thodes-http)
  - [`any`: Mappage avec n'importe quelle M√©thode HTTP](#any-mappage-avec-nimporte-quelle-m√©thode-http)
- [Groupes de Routes avec `prefix`](#groupes-de-routes-avec-prefix)
- [Personnalisation des Routes](#personnalisation-des-routes)
  - [Capturer des Variables dans l'URL](#capturer-des-variables-dans-lurl)
  - [Ajouter des Crit√®res de Validation sur les Variables](#ajouter-des-crit√®res-de-validation-sur-les-variables)
    - [Exemple avec une seule variable :](#exemple-avec-une-seule-variable-)
    - [Exemple avec plusieurs variables :](#exemple-avec-plusieurs-variables-)
  - [Nommer les Routes](#nommer-les-routes)
  - [Utilisation des Middlewares](#utilisation-des-middlewares)
    - [Exemple d'association de middleware :](#exemple-dassociation-de-middleware-)
  - [Composition d'Actions](#composition-dactions)
- [Utilisation de la m√©thode `route`](#utilisation-de-la-m√©thode-route)
  - [Prototype de la m√©thode `route`](#prototype-de-la-m√©thode-route)
  - [Liste des options disponibles dans `route`](#liste-des-options-disponibles-dans-route)
  - [Exemple d'utilisation de `route` avec une closure](#exemple-dutilisation-de-route-avec-une-closure)
  - [Exemple d'utilisation de `route` avec un contr√¥leur](#exemple-dutilisation-de-route-avec-un-contr√¥leur)
  - [Exemple d'utilisation de `route` avec un contr√¥leur et un middleware](#exemple-dutilisation-de-route-avec-un-contr√¥leur-et-un-middleware)
  - [Exemple d'utilisation de `route` avec un contr√¥leur, un middleware et une restriction](#exemple-dutilisation-de-route-avec-un-contr√¥leur-un-middleware-et-une-restriction)

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

## Introduction

Le routage est un √©l√©ment essentiel dans le d√©veloppement d'une application web. Il permet de relier une URL √† une action sp√©cifique dans le contr√¥leur de l'application. Dans BowPHP, le syst√®me de routage est directement int√©gr√© √† l'instance de l'application, via la variable superglobale `$app`.

Les routes de l'application se d√©finissent dans le fichier `app.php`, qui se trouve dans le dossier `routes` de votre projet.

## Mappage d'URL

Le syst√®me de routage de BowPHP permet de faire correspondre une URL √† un contr√¥leur ou une action. Cela se fait en associant une URL √† une m√©thode HTTP (`GET`, `POST`, `PUT`, `DELETE`, etc.) et en d√©finissant l'action √† ex√©cuter lorsqu'une requ√™te correspond √† cette route.

### Structure du Routage

Le routage dans BowPHP s'√©crit ainsi :

```php
$app->[method](url, action);
```

- **`method`** : Le verbe HTTP (`GET`, `POST`, `PUT`, `DELETE`, `OPTIONS`, `PATCH`), toujours √©crit en minuscule.
- **`url`** : L'URL √† matcher.
- **`action`** : L'action √† ex√©cuter. Cela peut √™tre une closure (fonction anonyme), un tableau de closures, ou le nom d'un contr√¥leur.

### Exemple de Routage

#### Avec une Closure :

```php
$app->get('/', function () {
    return 'Hello, World!';
});
```

> **Qu'est-ce qu'une closure ?**
Une *closure* est une fonction anonyme qui peut √™tre d√©finie √† la vol√©e et utilis√©e dans le routage de BowPHP. Pour plus d'infos, consultez la [documentation sur les closures](http://php.net/manual/fr/class.closure.php).

#### Avec un tableau de fonctions (callables) :

```php
$callables = [];

$callables[] = function () {
    echo 'Hello World';
    return true; // Retourne true pour ex√©cuter la fonction suivante
};

$callables[] = function () {
    echo 'Bien merci';
};

$app->get('/', $callables);
```

> **Attention** : La premi√®re fonction doit retourner `true` pour permettre √† la suivante de s'ex√©cuter. Si elle retourne `false`, l'ex√©cution des fonctions suivantes s'arr√™tera.

#### Avec un contr√¥leur :

```php
$app->get('/', 'UserController::action');
```

#### Avec un contr√¥leur et un middleware :

```php
$app->get('/', ['middleware' => 'ip', 'controller' => 'UserController::action']);
```

#### Utilisation d'un contr√¥leur avec la m√©thode `__invoke` :

Si le contr√¥leur impl√©mente la m√©thode magique `__invoke`, vous pouvez l'utiliser directement comme une fonction :

```php
$app->get('/', UserController::class);
```

## Liste des M√©thodes de Mappage

Voici les principales m√©thodes de routage dans BowPHP :

```php
$app->get($url, $action);
$app->post($url, $action);
$app->put($url, $action);
$app->delete($url, $action);
$app->option($url, $action);
$app->patch($url, $action);
```

### Exemples de Routage avec diff√©rentes M√©thodes HTTP

- **`GET`** : Pour r√©cup√©rer des donn√©es

```php
$app->get('/', function () {
    return 'Hello, World!';
});
```

- **`POST`** : Pour envoyer des donn√©es au serveur

```php
$app->post('/', function () {
    return 'Data posted';
});
```

- **`PUT`** : Pour mettre √† jour des ressources existantes

```php
$app->put('/', function () {
    return 'Resource updated';
});
```

- **`DELETE`** : Pour supprimer une ressource

```php
$app->delete('/', function () {
    return 'Resource deleted';
});
```

- **`PATCH`** : Pour appliquer des modifications partielles √† une ressource

```php
$app->patch('/', function () {
    return 'Partial update applied';
});
```

- **`OPTIONS`** : Pour r√©cup√©rer les options disponibles pour une ressource

```php
$app->options('/', function () {
    return 'Options retrieved';
});
```

:::note
**Note importante** : Les navigateurs ne supportent pas les m√©thodes `DELETE`, `PUT` et `PATCH` nativement. Pour contourner cette limitation, vous pouvez ajouter un champ cach√© dans vos formulaires HTML :
:::

```html
<input type="hidden" name="_method" value="DELETE">
```

Ceci va permettre √† BowPHP de comprendre que vous voulez contacter la route associ√©e √† la methode `DELETE`

## Mappage Multiple

### `match`: Mappage avec plusieurs M√©thodes HTTP

Si vous souhaitez faire correspondre plusieurs m√©thodes HTTP (comme `GET` et `POST`) √† une m√™me URL, vous pouvez utiliser la m√©thode `match` :

```php
$app->match(['GET', 'POST'], '/users', function () {
    // Code ici
});
```

Vous pouvez √©galement traiter les diff√©rents types de requ√™tes dans une seule action :

```php
use Bow\Http\Request;

$app->match(['GET', 'POST'], '/users', function (Request $request) {
    if ($request->isPost()) {
        // Traitement pour la requ√™te POST
    } else {
        // Traitement pour la requ√™te GET
    }
});
```

### `any`: Mappage avec n'importe quelle M√©thode HTTP

Si vous souhaitez que n'importe quelle m√©thode HTTP corresponde √† une URL, vous pouvez utiliser `any` :

```php
$app->any('/', function () {
    // Code ici
});
```

## Groupes de Routes avec `prefix`

Lorsque vous avez plusieurs routes qui partagent un pr√©fixe similaire (par exemple, `/users`, `/users/:id`, `/users/:id/delete`), vous pouvez utiliser la m√©thode `prefix` pour organiser votre code de mani√®re plus propre.

```php
$app->prefix('/users', function () use ($app) {
    $app->get('/', function () {
        // Code pour r√©cup√©rer tous les utilisateurs
    });

    $app->get('/:id', function ($id) {
        // Code pour r√©cup√©rer un utilisateur par ID
    });

    $app->get('/:id/delete', function ($id) {
        // Code pour supprimer un utilisateur
    });
});
```

:::danger
**Note** : La m√©thode `prefix` ne peut pas √™tre imbriqu√©e dans d'autres groupes de routes.
:::


## Personnalisation des Routes

BowPHP permet de personnaliser vos routes de plusieurs fa√ßons, notamment :

- Capturer des variables dans l'URL
- Ajouter des crit√®res de validation sur les variables captur√©es
- Nommer les routes pour une gestion plus facile
- Associer des middlewares √† des routes sp√©cifiques
- Combiner diff√©rentes actions (middleware, contr√¥leur)

### Capturer des Variables dans l'URL

Pour capturer des variables dans l'URL, utilisez la notation `:variable_name`. Ces variables seront ensuite pass√©es √† l'action correspondante.

```php
$app->get('/:name', function ($name) {
    return 'Bonjour ' . $name;
});
```

### Ajouter des Crit√®res de Validation sur les Variables

Lorsque vous capturez des variables, vous pouvez les valider √† l'aide de la m√©thode `where` pour garantir que les donn√©es sont bien conformes √† une certaine r√®gle.

#### Exemple avec une seule variable :

```php
$app->get('/:name', function ($name) {
    return 'Bonjour ' . $name;
})->where('name', '[a-z]+');
```

#### Exemple avec plusieurs variables :

```php
$app->get('/:name/:lastname/:number', function ($name, $lastname, $number) {
    return sprintf('Bonjour %s %s, votre num√©ro est %s', $name, $lastname, $number);
})->where([
    'name' => '[a-z]+',
    'lastname' => '[a-z]+',
    'number' => '\d+'
]);
```

> **Note** : La m√©thode `where` permet de d√©finir des r√®gles de validation pour chaque variable captur√©e dans l'URL.

### Nommer les Routes

Pour faciliter la gestion des routes dans les grandes applications, vous pouvez leur attribuer des noms. Cela permet de r√©f√©rencer facilement une route dans votre code.

```php
$app->get('/:name', function ($name) {
    return 'Bonjour ' . $name;
})->name('greeting');
```

### Utilisation des Middlewares

Un middleware est une fonction ou un ensemble de fonctions qui interviennent entre la requ√™te et l'action √† ex√©cuter. Vous pouvez associer un ou plusieurs middlewares √† une route.

#### Exemple d'association de middleware :

```php
$app->get('/:name', ['middleware' => 'auth', function ($name) {
    return 'Bonjour ' . $name;
}]);

// Ou avec la m√©thode `middleware()` :
$app->get('/:name', function ($name) {
    return 'Bonjour ' . $name;
})->middleware('auth');
```

### Composition d'Actions

BowPHP permet √©galement de combiner un contr√¥leur et un middleware pour une route sp√©cifique. Voici un exemple :

```php
$app->get('/:name', [
    'middleware' => 'auth',
    'controller' => 'UserController::show'
]);
```

## Utilisation de la m√©thode `route`

La m√©thode `route` dans BowPHP permet de d√©finir une route de mani√®re plus simple et flexible. Elle accepte un tableau de param√®tres, ce qui vous permet de personnaliser la route de fa√ßon plus d√©taill√©e.

### Prototype de la m√©thode `route`

```php
$app->route([
  'path' => '/',
  'method' => "GET",
  'handler' => 'handler'
]);
```

### Liste des options disponibles dans `route`

| Param√®tre   | Type         | Description                                           |
|-------------|--------------|-------------------------------------------------------|
| `path`      | `String`     | Le chemin de l'URL √† matcher                         |
| `method`    | `String`, `Array` | M√©thode HTTP (`GET`, `POST`, `PUT`, `DELETE`, `OPTIONS`, `PATCH`) |
| `handler`   | `String`, `Array` | Action √† ex√©cuter (peut √™tre une closure, un contr√¥leur, etc.) |
| `middleware`| `String`, `Array` | Middleware(s) √† appliquer avant d'ex√©cuter l'action |
| `where`     | `String`, `Array` | Contrainte(s) appliqu√©e(s) sur les variables dans l'URL |
| `name`      | `String`, `Array` | Nom de la route pour une gestion facile               |

### Exemple d'utilisation de `route` avec une closure

```php
$app->route([
  'path' => '/',
  'method' => "GET",
  'handler' => function () {
    return "Hello, Bow";
  }
]);
```

### Exemple d'utilisation de `route` avec un contr√¥leur

```php
$app->route([
  'path' => '/',
  'method' => "GET",
  'handler' => 'HomeController::action'
]);
```

> **Note** : Pour plus d'informations sur les contr√¥leurs, consultez la section [Contr√¥leurs](./controllers).

### Exemple d'utilisation de `route` avec un contr√¥leur et un middleware

```php
$app->route([
  'path' => '/',
  'method' => "GET",
  'handler' => 'HomeController::show',
  'middleware' => ['auth']
]);
```

> **Note** : Pour en savoir plus sur les middlewares, consultez la section [Middleware](./middleware).

### Exemple d'utilisation de `route` avec un contr√¥leur, un middleware et une restriction

```php
$app->route([
  'path' => '/:name',
  'method' => "GET",
  'handler' => 'HomeController::show',
  'middleware' => ['auth'],
  'where' => ['name' => '[a-z]+']
]);
```

Cette m√©thode est particuli√®rement utile lorsque vous avez besoin d'une syntaxe plus concise et que vous souhaitez avoir plus de contr√¥le sur les param√®tres de votre route.

<SuggestionFeature />
