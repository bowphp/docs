---
id: controller
title: "üë®üèΩ‚Äç‚úàÔ∏è Contr√¥leurs"
---

- [Introduction](#introduction)
- [Configuration](#configuration)
- [Contr√¥leur basic](#contr√¥leur-basic)
  - [D√©finir un contr√¥leur](#d√©finir-un-contr√¥leur)
  - [Contr√¥leur et espaces de noms](#contr√¥leur-et-espaces-de-noms)
  - [Contr√¥leur et Middleware](#contr√¥leur-et-middleware)
- [Contr√¥leur REST](#contr√¥leur-rest)
  - [D√©finir un contr√¥leur rest](#d√©finir-un-contr√¥leur-rest)
  - [Utilisons notre contr√¥leur REST](#utilisons-notre-contr√¥leur-rest)
    - [Prototype de la m√©thode `rest`](#prototype-de-la-m√©thode-rest)
    - [Utilisation simple](#utilisation-simple)
    - [Utilisation avec les contraintes](#utilisation-avec-les-contraintes)
    - [Utilisation via un tableau comme action](#utilisation-via-un-tableau-comme-action)
    - [Ignore des m√©thodes](#ignore-des-m√©thodes)
    - [Url et Action](#url-et-action)
- [Il manque quelque chose ?](#il-manque-quelque-chose-)

## Introduction

Les contr√¥leurs sont des moyens pour simplifier l'organisation de vos projet.

Au lieu de d√©finir toute la logique de gestion des requ√™te en tant que `closure` dans les fichiers de routage, vous pouvez organiser ce comportement √† l'aide de classe de contr√¥leur. Les contr√¥leurs peuvent regrouper la logique de traitement des requ√™tes associ√©e en une seule classe.

Les contr√¥leurs sont stock√©s dans le r√©pertoire `app/Controllers`.

<script id="asciicast-1r0hZPnP5wY5fCPcxNXtLTQ4r" src="https://asciinema.org/a/1r0hZPnP5wY5fCPcxNXtLTQ4r.js" data-speed="2" data-rows="20" async></script>

## Configuration

Vous avez la possibilit√© de modifier le `namespace` des contr√¥leurs et des middlewares. Pour ce faire ouvrez le fichier `app\Kernel.php`. La m√©thode `middlewares` permet √† Bow de savoir quel est le bon `namespace` √† ajouter sur le contr√¥leur lors de l'execution de la r√©qu√™te ou lors de la g√©n√©ration de contr√¥leur ou de middleware par le lanceur de tache `php bow`.

Imaginez que vous avez une application pour la gestion des Bus d'une √©cole et que vous voulez grouper tout vos contr√¥leurs dans le `App\Bus\Controllers`. Alors comment faire √ßa ?

Voici le code que cela pourrait donn√©e:

```php
# Dans le fichier `app\Kernel.php`
public function namespaces()
{
  return [
    "controller" => "App\\Bus\\Controllers",
    ...
  ]
}
```

Ensuite il faudra aussi changer un peu la configuration du lancer de tache:

```php
# Dans le fichier `bow`
$command = new Bow\Console\Command(__DIR__);
...
$command->setControllerDirectory(__DIR__.'/app/Bus/Controllers');
```

> Visitez ce [lien](./structure) pour plus d'information sur la personnalisation de la structure de l'application.

## Contr√¥leur basic

### D√©finir un contr√¥leur

Voici un exemple de classe de contr√¥leur de base. Notez que le contr√¥leur h√©rite de la classe `App\Controllers\Controller` de base. Cette classe de base fournit quelques m√©thodes pratiques telles que la m√©thode du `render`, qui peut √™tre utilis√©e pour compiler une vue.

```php
namespace App\Controllers;

use App\Controllers\Controller;
use App\Models\User;

class UserController extends Controller
{
  /**
   * Afficher le profil pour l'utilisateur donn√©.
   *
   * @param int $id
   * @return mixed
   */
  public function show($id)
  {
    return $this->render('user/profile', ['user' => User::findOrFail($id)]);
  }
}
```

Vous pouvez d√©finir une route dans le fichier `routes/app.php` vers cette action de contr√¥leur comme suit:

```php
$app->get('user/:id', 'UserController::show');
```

D√©sormais, lorsqu'une demande correspond √† l'URI de la route sp√©cifi√©e, la m√©thode `show` de la classe `UserController` sera ex√©cut√©e. Bien entendu, les param√®tres de la route seront √©galement transmis √† la m√©thode.

Vous pouvez g√©n√©rer un contr√¥leur en utilisant la commande `add:controller` de `php bow`:

```bash
php bow add:controller UserController
```

### Contr√¥leur et espaces de noms

Il est tr√®s important de noter que nous n‚Äôavons pas eu besoin de sp√©cifier le `namespace` du contr√¥leur complet lors de la d√©finition de la route du contr√¥leur. √âtant donn√© que `public/index.php` charge vos fichiers de route dans un groupe de routage contenant le `namespace`, nous avons uniquement sp√©cifi√© la partie du nom de classe qui vient apr√®s la partie `App\Controllers` de le `namespace`.

Si vous choisissez d'imbriquer vos contr√¥leurs plus profond√©ment dans le r√©pertoire `App\Controllers`, utilisez le nom de classe sp√©cifique relatif √† le `namespace` racine `App\Controllers`. Donc, si votre classe de contr√¥leur compl√®te est `App\Controllers\Photo\AdminController`, vous devez enregistrer les routes sur le contr√¥leur comme suit:

```php
$app->get('/foo', 'Photo\AdminController::action');
```

Vous pouvez g√©n√©rer un contr√¥leur en utilisant la commande `add:controller` de `php bow`:

```bash
php bow add:controller Photo/AdminController
```

> Remarquez bien le nom du dossier c'est en camel case. Le framework cr√©√©ra le namespace appropri√© pour la classe `AdminController` et qui sera `namepsace App\Controllers\Photo;`. Vous trouverez le controller dans un dossier `app/Controllers/Photo/AdminController`.

Plus d'information sur le [routing](./routing).

### Contr√¥leur et Middleware

Les middlewares peuvent √™tre assigner √† la route du contr√¥leur dans vos fichiers de route. Les middleware sont stock√©s dans le dossier `app\Middlewares`. Pour plus d'information sur les middlewares, visitez ce [lien](./middleware).

Exemple:

```php
$app->get('profile', 'UserController::show')->middleware('auth');
```

## Contr√¥leur REST

Les contr√¥leur REST sont un moyen simple pour mettre en place un API Rest. Cette approche, vous permet de vous concentrez sur votre logique et laisser le Framework g√©r√© le routage pour vous.

### D√©finir un contr√¥leur rest

Pour d√©finir un nouveau contr√¥leur Rest, nous devez utiliser le lancer de tache `php bow` avec la commande `generate:resource` dans votre console ou invite de commande :sunglasses:.

```bash
php bow generate:resource PetController
```

Un contr√¥leur nomm√© `PetController` sera donc cr√©√©. Ce qui fait √ßa particularit√© c'est qu'il y a d√©j√† des m√©thodes pr√©d√©finir en lui et ces m√©thodes doivent rester telles quelles.

```php
namespace App\Controllers;

use App\Controllers\Controller;
use App\Models\Pet;

class PetController extends Controller
{
  /**
   * Point d'entr√©
   *
   * @return void
   */
  public function index()
  {
    // Codez Ici
  }

  /**
   * Permet d'afficher la vue permettant de cr√©er une r√©source.
   *
   * @return void
   */
  public function create()
  {
    // Codez Ici
  }

  /**
   * Permet d'ajouter une nouvelle r√©source dans la base d'information
   *
   * @return void
   */
  public function store()
  {
    // Codez Ici
  }

  /**
   * Permet de r√©cup√©rer un information pr√©cise avec un identifiant.
   *
   * @param mixed $id
   * @return void
   */
  public function show($id)
  {
    // Codez Ici
  }

  /**
   * Mise √† jour d'un ressource en utilisant param√®tre du GET
   *
   * @param mixed $id
   * @return void
   */
  public function edit($id)
  {
    // Codez Ici
  }

  /**
   * Mise √† jour d'une r√©source
   *
   * @param mixed $id
   * @return void
   */
  public function update($id)
  {
    // Codez Ici
  }

  /**
   * Permet de supprimer une resource
   *
   * @param mixed $id
   * @return void
   */
  public function destroy($id)
  {
    // Codez Ici
  }
}
```

### Utilisons notre contr√¥leur REST

Pour utiliser le contr√¥leur Rest vous avez juste √† utiliser le m√©thode `rest` sur la variable globale `$app` dans vos fichiers de [routing](./routing).

#### Prototype de la m√©thode `rest`

```php
$app->rest(url, action, where = []);
```

| paramete | Type |
|----------|------|
| `url` | `String`, `Array` - Le nom de la route |
| `action` | `String` -  Le nom de la route |
| `where` | `Array` - Contrainte sur la varible `id` |

#### Utilisation simple

Et √ßa donne ceci:

```php
$app->rest('pets', 'PetController');
```

#### Utilisation avec les contraintes

Avec une contrainte √ßa donne ceci:

```php
$app->rest('pets', 'PetController', ['id' => '\d+']);
```

Ici la contrainte s'applique sur tous les m√©thodes. Mais, vous avez aussi la possibilit√© de restreindre les contraintes sur des m√©thodes comme ceci:

```php
$app->rest('pets', 'PetController', [
  'show' => ['id' => '\d+'],
  'edit' => ['id' => '[a-z]+'],
]);
```

#### Utilisation via un tableau comme action

Dans le cas ou `action` est un `array` voici les cl√©s/valeurs possible.

```php
$action = [
  'controller' => 'PetController',
  'ignores' => ['index', 'create'],
];

$app->rest('pets', $action, ['id' => '\d+']);
```

#### Ignore des m√©thodes

La valeur de `ignores` sear une liste de m√©thode/url qui seront ignor√©es par le `routeur`. Alors, dans l'exemple pr√©c√©dent les m√©thodes `index` et `create` seront indisponibles.

#### Url et Action

En considerant la d√©finition Rest suivant:

```php
$action = [
  'controller' => 'PetController',
  'ignores' => ['index', 'create'],
];

$app->rest('pets', $action, ['id' => '\d+']);
```

| URL | M√©thode HTTP | Nom de la route | Description |
|----------|------|------|------|
| `/pets` | `GET` | `pets.index` | Retourne la liste des pets |
| `/pets` | `POST` | `pets.store` | Permet d'ajouter un autre pet |
| `/pets/:id` | `GET` | `pets.show` | Afficher un seul pet |
| `/pets/:id` | `PUT/PATCH` | `pets.update` | Permet de mettre √† jour les informations d'un pet |
| `/pets/:id` | `DELETE` | `pets.delete` | Ceci va supprimer un pet |
| `/pets/create` | `GET` | `pets.create` | Permet d'afficher le formulaire d'ajout |

## Il manque quelque chose ?

Si vous rencontrez des probl√®mes avec la documentation ou si vous avez des suggestions pour am√©liorer la documentation ou le projet en g√©n√©ral, veuillez d√©poser une issue pour nous, ou envoyer un tweet mentionnant le compte Twitter @BowFramework ou sur directement sur le [github](https://github.com/bowphp/docs/issues).
