---
id: cqrs
title: "ðŸ¤  CQRS"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

**CQRS** (*sÃ©grÃ©gation des responsabilitÃ©s des requÃªtes de commande*).

Au cÅ“ur se trouve l'idÃ©e selon laquelle vous pouvez utiliser un modÃ¨le diffÃ©rent pour mettre Ã  jour les informations que celui que vous utilisez pour lire les informations.
Dans certaines situations, cette sÃ©paration peut Ãªtre utile, mais sachez que pour la plupart des systÃ¨mes, **CQRS** ajoute une complexitÃ© risquÃ©e.

[Pour plus d'information](https://www.martinfowler.com/bliki/CQRS.html)

## Install

Installez le package suivant: 

```bash
composer require bowphp/cqrs
```

## Help

Tout d'abord, crÃ©ez l'exemple de commande:

```php
use Bow\CQRS\Command\CommandInterface;

class CreateUserCommand implements CommandInterface
{
  public function __construct(
    public string $username,
    public string $email
  ) {}
}
```

CrÃ©ez le gestionnaire ici :

```php
use Bow\CQRS\Command\CommandHandlerInterface;

class CreateUserCommandHandler implements CommandHandlerInterface
{
    public function __construct(public UserService $userService) {}

    public function process(CommandInterface $command): mixed
    {
        if ($this->userService->exists($command->email)) {
            throw new UserServiceException(
                "The user already exists"
            );
        }

        return $this->userService->create([
            "username" => $command->username,
            "email" => $command->email
        ]);
    }
}
```

Ajouter une commande au registre dans `App\Configurations\ApplicationConfiguration::class`:

```php title="app/Configurations/ApplicationConfiguration.php"
use Bow\CQRS\Registration as CQRSRegistration;

public function run()
{
    CQRSRegistration::commands([
        CreateUserCommand::class => CreateUserCommandHandler::class
    ]);
}
```

ExÃ©cuter la commande dans le contrÃ´leur:

```php
namespace App\Controllers;

use App\Controllers\Controller;
use App\Commands\CreateUserCommand;

class UserController extends Controller
{
    public function __construct(private CommandBus $commandBus) {}

    public function __invoke(Request $request)
    {
        $payload = $request->only(['username', 'email']);

        $command = new CreateUserCommand(
            $payload['username'],
            $payload['email']
        );

        $result = $this->commandBus->execute($command);

        return redirect()
            ->back()
            ->withFlash("message", "User created");
    }
}
```

Mettre un nouvel itinÃ©raire :

```php
$app->post("/users/create", UserController::class);
```

<SuggestionFeature />
