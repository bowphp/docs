---
id: storage
title: "ðŸ’¿ Stockage"
---

import SuggestionFeature from "@site/src/components/Partials/SuggestionFeature";

## Introduction

Bow Framework intÃ¨gre un systÃ¨me de gestion de fichier permettant de manipuler des fichiers avec une grande simplicitÃ©.

## Configuration

Le fichier de configuration du systÃ¨me de gestion de fichiers se trouve dans `config/resource.php`.

## Fonctionnement

Vous avez la possibilitÃ© d'utiliser les services ou travailler dans votre disque local. Les mÃ©thodes statiques `mount` et `service` permettent reciproquement de manipuler le systÃ¨me de disque et les services de stockage actuellement `ftp` et `s3`.

### SystÃ¨me de fichier local

Pour gÃ©rer votre systÃ¨me de fichier local avec Bow Framework vous allez utiliser la mÃ©thode statique `mount`.

#### Explication du concept

Nous appelerons les diffÃ©rents dossiers spÃ©cifiÃ©s `disk`.

ConsidÃ©rons la configuration suivante:

```php
'disk' =>[
  'mount' => 'storage',
  'path' => [
    'storage' => __DIR__.'/../var/app',
    'public' => __DIR__.'/../public',
  ]
];
```

> Vous pouvez spÃ©cifier autant de disques que vous voulez.

La classe `Storage` expose la mÃ©thode statique `mount` qui permet la manipulation de fichiers. La valeur passÃ©e Ã  `mount` doit Ãªtre un nom de disque valide spÃ©cifiÃ© dans la liste des `path`.

```php
use Bow\Storage\Storage;

Storage::app_local_storage("public");
// Ou
Storage::app_local_storage();
```

> Si la mÃ©thode `mount` est appelÃ© sans paramÃªtre, elle utilisera par dÃ©faut la valeur de la clÃ© `mount`.

Vous pouvez aussi utiliser le helper `app_local_storage()` qui fonctionne exactement de la mÃªme maniÃ¨re:

```php
app_local_storage('public');
// Ou
app_local_storage()->get('app.js');
```

### Les services S3 et FTP

Pour utiliser un systÃ¨me de stockage externe. Cela se fait via la mÃ©thode `service`. Cette mÃ©thode, vous permet de sÃ©lÃ©ctionner le type de stockage externe que vous voulez utiliser. Vous trouverez la configuration nÃ©cessaire des services dans le fichier de configuration section `services` du fichier `config/resource.php`.

Exemple avec le service `ftp`:

```php
$service = Storage::service('ftp');
$service->get('app.js');
```

## Manipulation des fichiers

Cette section dÃ©crit les diffÃ©rentes mÃ©thodes disponible pour la manipulation de fichiers et leur utilisation.

Supposons que nous avons le fichier `app.txt` dans le disque `public`:

```plain
// contenu du fichier app.txt
Hello, world
```

> Notez que ces mÃ©thodes (sauf la mÃ©thode `get`) retournent respectivement `true` ou `false` en cas de succÃ¨s ou d'Ã©chec

### RÃ©cupÃ©rer le contenu d'un fichier

La mÃ©thode `get` sert Ã  recupÃ©rer le contenu d'un fichier. Elle prend comme paramÃ¨tre le nom du fichier.

```php
$mount = app_local_storage('public');
$content = $mount->get("app.txt");

// Avec un service
$service = Storage::service('ftp');
$content = $service->get("app.txt");

echo $content;
// => Hello, world
```

> `service` et `mount` utilise la mÃªme interface de manipulation. Ce qui veux dire que les mÃ©thodes disponibles pour `mount` existe aussi pour `service`.

### Ajouter/Modifier le contenu d'un fichier

La mÃ©thode `put` permet d'ajouter ou de modifier le contenu d'un fichier:

```php
$mount = app_local_storage('public');
$content = 'console.log("Hello, world")';

$mount->put('app.js', $content );
```

### Ajouter du contenu au dÃ©but ou Ã  la fin d'un fichier

Les mÃ©thodes `preprend` et `append` vous permettent d'ajouter respectivement du contenu au debut ou la fin d'un fichier:

```php
$mount = app_local_storage('public');

$mount->prepend('app.txt', 'Contenu ajoutÃ© au dÃ©but');
$mount->append('app.txt', 'Contenu ajoutÃ© Ã  la fin');
```

### Supprimer un fichier

La mÃ©thode `delete` permet de supprimer un fichier.

```php
$mount = app_local_storage('public');

$mount->delete('app.js');
```

### Copier un fichier

```php
$mount = app_local_storage('public');

$mount->copy('app.txt', 'sous-dossier/app.txt');
```

### CrÃ©er un dossier

Vous pouvez crÃ©er un nouveau dossier Ã  l'aide de la mÃ©thode `makeDirectory`:

#### Prototype

```php
$mount = app_local_storage('public');

$mount->makeDirectory($dirname, $mode = 0777, $recursive = false);
```

| ParamÃ¨tre | Type |
|------|-----|
| path | `String` - le dossier Ã  crÃ©er |
| mode | `Int` - Le mode du dossier par dÃ©faut 777 |
| recursive | `Boolean` - Permet de crÃ©er rÃ©cursivement |

```php
$mount = app_local_storage('public');

$mount->makeDirectory('dossier');
```

> Notez que vous pouvez changer le mode du dossier et choisir de le crÃ©er de maniÃ¨re rÃ©cursif.

```php
$mount->makeDirectory('chemin/vers/un/dossier', 777, true);
```

### VÃ©rifier si un fichier existe

```php
$mount = app_local_storage('public');

if ($mount->exists('app.txt')) {
  echo $mount->get('app.txt');
}
```

### VÃ©rifier si le paramÃªtre est un fichier

```php
$mount = app_local_storage('public');

if ($mount->isFile('app.txt')) {
  echo "C'est un fichier";
}
```

### VÃ©rifier si le paramÃªtre est un dossier

```php
$mount = app_local_storage('public');

if ($mount->isDirectory('nom_du_dossier')) {
  echo "C'est un dossier";
}
```

### Obtenir le chemin absolu d'un fichier ou dossier

```php
$mount = app_local_storage('public');

$path = $mount->path('app.txt');

echo $path;
// => /chemin/absolu/vers/le/fichier/app.txt
```

<SuggestionFeature />
